"use strict";(self.webpackChunkInstiKit=self.webpackChunkInstiKit||[]).push([[6387],{43098:(e,t,n)=>{n.d(t,{Z:()=>o});var a=n(94015),r=n.n(a),s=n(23645),i=n.n(s)()(r());i.push([e.id,".loading-overlay.is-full-page{z-index:1060}","",{version:3,sources:["webpack://./resources/js/views/student/fee/index.vue"],names:[],mappings:"AAk2BA,8BACA,YACA",sourcesContent:['<template>\r\n    <div>\r\n        <div class="page-titles">\r\n            <div class="row">\r\n                <div class="col-12 col-sm-6">\r\n                    <h3 class="text-themecolor">{{trans(\'finance.fee_detail\')}} <small v-if="student_record.student">{{getStudentName(student_record.student)}}  ({{student_record.academic_session.name}})</small>\r\n                    </h3>\r\n                </div>\r\n                <div class="col-12 col-sm-6">\r\n                    <div class="action-buttons pull-right">\r\n                        <router-link to="/student/list" class="btn btn-info btn-sm"><i class="fas fa-list"></i> <span class="d-none d-sm-inline">{{trans(\'student.student\')}}</span></router-link>\r\n                        <div class="btn-group">\r\n                            <button type="button" class="btn btn-info btn-sm dropdown-toggle no-caret " role="menu" id="moreOption" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" v-tooltip="trans(\'general.more_option\')">\r\n                                <i class="fas fa-ellipsis-h"></i> <span class="d-none d-sm-inline"></span>\r\n                            </button>\r\n                            <div :class="[\'dropdown-menu\',getConfig(\'direction\') == \'ltr\' ? \'dropdown-menu-right\' : \'\']" aria-labelledby="moreOption">\r\n                                <button class="dropdown-item custom-dropdown" @click="$router.push(\'/student/\'+student_record.student.uuid)"><i class="fas fa-arrow-circle-right"></i> {{trans(\'student.view_detail\')}}</button>\r\n                                <button class="dropdown-item custom-dropdown" v-if="hasPermission(\'set-fee\')" @click="$router.push(\'/student/\'+student_record.student.uuid+\'/fee/\'+student_record.id+\'/set\')"><i class="fas fa-file"></i> {{trans(\'student.set_fee\')}}</button>\r\n                                <button class="dropdown-item custom-dropdown" @click="print"><i class="fas fa-print"></i> {{trans(\'general.print\')}}</button>\r\n                                <button class="dropdown-item custom-dropdown" @click="pdf"><i class="fas fa-file-pdf"></i> {{trans(\'general.generate_pdf\')}}</button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class="container-fluid">\r\n            <div class="row">\r\n                <div class="col-12">\r\n                    <div class="card">\r\n                        <div class="card-body py-4">\r\n                            <student-summary :student-record="student_record" class="border-bottom"></student-summary>\r\n                        </div>\r\n                        <div class="card-body">\r\n                            <div class="row justify-content-end px-4" v-if="hasPermission(\'customize-fee-date\')">\r\n                                <div class="col-12 col-sm-3">\r\n                                    <div class="form-group">\r\n                                        <datepicker v-model="feePayment.date" :bootstrapStyling="true" :placeholder="trans(\'student.date_of_payment\')"></datepicker>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                            <template v-for="fee_allocation_group in student_record.fee_allocation.fee_allocation_groups">\r\n                                <h4 class="card-title m-l-20">{{fee_allocation_group.fee_group.name}}</h4>\r\n                                <div class="table-responsive p-3">\r\n                                    <table class="table table-sm">\r\n                                        <thead>\r\n                                            <tr>\r\n                                                <th>{{trans(\'finance.fee_installment_title\')}}</th>\r\n                                                <th>{{trans(\'finance.fee_installment_due_date\')}}</th>\r\n                                                <th v-for="fee_head in fee_allocation_group.fee_group.fee_heads" v-text="fee_head.name"></th>\r\n                                                <th>\r\n                                                    <span v-if="fee_allocation_group.fee_group.options.has_transport">{{trans(\'transport.circle\')}}</span>\r\n                                                </th>\r\n                                                <th>\r\n                                                    <span v-if="fee_allocation_group.fee_group.options.has_transport">{{trans(\'transport.fee\')}}</span>\r\n                                                </th>\r\n                                                <th>{{trans(\'finance.late_fee\')}}</th>\r\n                                                <th>{{trans(\'finance.installment_total\')}}</th>\r\n                                                <th>{{trans(\'finance.other\')}}</th>\r\n                                                <th>{{trans(\'finance.paid\')}}</th>\r\n                                                <th>{{trans(\'finance.balance\')}}</th>\r\n                                                <th v-if="hasPermission(\'make-fee-payment\')">{{trans(\'finance.pay_fee\')}}</th>\r\n                                                <th v-else>{{trans(\'finance.fee_status\')}}</th>\r\n                                            </tr>\r\n                                        </thead>\r\n                                        <tbody>\r\n                                            <tr v-for="fee_installment in fee_allocation_group.fee_installments">\r\n                                                <td>{{fee_installment.title}}</td>\r\n                                                <td>{{getInstallmentDueDate(fee_installment)}}\r\n                                                    <template v-if="isInstallmentOverdue(fee_installment)">\r\n                                                        <br />\r\n                                                        <span class="label label-danger">{{trans(\'finance.fee_overdue_day\', {day: isInstallmentOverdue(fee_installment)})}}</span>\r\n                                                    </template>\r\n                                                </td>\r\n                                                <td v-for="fee_head in fee_allocation_group.fee_group.fee_heads">\r\n                                                    <span v-if="checkInstallmentConcession(fee_installment, fee_head.id)" style="text-decoration: line-through;">{{getInstallmentFeeAmountWithoutConcession(fee_installment, fee_head.id)}}</span>\r\n                                                    {{getInstallmentFeeAmount(fee_installment, fee_head.id)}}\r\n                                                </td>\r\n                                                <td>\r\n                                                    <span v-if="fee_allocation_group.fee_group.options.has_transport">{{getTransportCircleName(fee_installment)}}</span>\r\n                                                </td>\r\n                                                <td>\r\n                                                    <span v-if="fee_allocation_group.fee_group.options.has_transport">{{getTransportFeeAmount(fee_installment)}}</span>\r\n                                                </td>\r\n                                                <td>{{getLateFeeAmount(fee_installment)}}</td>\r\n                                                <td>{{getInstallmentTotalAmount(fee_installment)}}</td>\r\n                                                <td>{{getInstallmentOtherAmount(fee_installment)}}</td>\r\n                                                <td>{{getInstallmentPaidAmount(fee_installment)}}</td>\r\n                                                <td>{{getInstallmentBalanceAmount(fee_installment)}}</td>\r\n                                                <td v-if="hasPermission(\'make-fee-payment\')">\r\n                                                    <span v-if="getInstallmentStatus(fee_installment) == \'unpaid\'">\r\n                                                        <button type="button" class="btn btn-info btn-sm" @click="showInstallmentDetail(fee_allocation_group,fee_installment)">{{trans(\'finance.pay_fee\')}}</button>\r\n                                                    </span>\r\n                                                    <span v-else-if="getInstallmentStatus(fee_installment) == \'cancelled\'">\r\n                                                        <span class="label label-danger">{{trans(\'finance.fee_status_cancelled\')}}</span>\r\n                                                    </span>\r\n                                                    <span v-else>\r\n                                                        <div class="btn-group">\r\n                                                            <template v-if="getInstallmentStatus(fee_installment) == \'paid\'">\r\n                                                                <button class="btn btn-sm btn-success">{{trans(\'student.fee_status_paid\')}}</button>\r\n                                                                <button type="button" class="btn btn-sm btn-success dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\r\n                                                                    <span class="sr-only">Toggle Dropdown</span>\r\n                                                                </button>\r\n                                                            </template>\r\n                                                            <template v-if="getInstallmentStatus(fee_installment) == \'partially_paid\'">\r\n                                                                <button class="btn btn-sm btn-warning" @click="showInstallmentDetail(fee_allocation_group,fee_installment)">{{trans(\'student.fee_status_partially_paid\')}}</button>\r\n                                                                <button type="button" class="btn btn-sm btn-warning dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\r\n                                                                    <span class="sr-only">Toggle Dropdown</span>\r\n                                                                </button>\r\n                                                            </template>\r\n\r\n                                                            <div class="dropdown-menu">\r\n                                                                <button class="dropdown-item custom-dropdown-menu" @click.prevent="setTransaction(fee_installment)" v-if="getInstallmentPaid(fee_installment)">\r\n                                                                    <i class="fas fa-arrow-circle-right"></i> {{trans(\'finance.receipt_detail\')}}\r\n                                                                </button>\r\n                                                                <button class="dropdown-item custom-dropdown-menu" :key="fee_installment.id" v-confirm="{ok: confirmEmptyReceiptDelete(fee_installment)}" v-else-if="!getInstallmentPaid(fee_installment) && hasPermission(\'cancel-fee-payment\')">\r\n                                                                    <i class="fas fa-arrow-circle-right"></i> {{trans(\'student.cancel_fee_payment\')}}\r\n                                                                </button>\r\n                                                            </div>\r\n                                                        </div>\r\n                                                    </span>\r\n                                                </td>\r\n                                                <td v-else>\r\n                                                    <span v-if="getInstallmentStatus(fee_installment) == \'unpaid\'">{{trans(\'student.fee_status_unpaid\')}}</span>\r\n                                                    <span v-else>{{trans(\'student.fee_status_paid\')}}</span>\r\n                                                </td>\r\n                                            </tr>\r\n\r\n                                            <tr>\r\n                                                <th colspan="2">{{trans(\'general.total\')}}</th>\r\n                                                <th v-for="fee_head in fee_allocation_group.fee_group.fee_heads">\r\n                                                    {{getTotalFee(fee_allocation_group, fee_head.id)}}\r\n                                                </th>\r\n                                                <th></th>\r\n                                                <th>\r\n                                                    <span v-if="fee_allocation_group.fee_group.options.has_transport">{{getTransportFeeTotal(fee_allocation_group)}}</span>\r\n                                                </th>\r\n                                                <th>{{getLateFeeTotal(fee_allocation_group)}}</th>\r\n                                                <th>{{getInstallmentGrandTotal(fee_allocation_group)}}</th>\r\n                                                <th>{{getInstallmentGrandOther(fee_allocation_group)}}</th>\r\n                                                <th>{{getInstallmentPaidGrandTotal(fee_allocation_group)}}</th>\r\n                                                <th>{{getInstallmentBalanceGrandTotal(fee_allocation_group)}}</th>\r\n                                                <th v-if="hasPermission(\'make-fee-payment\')"></th>\r\n                                                <th v-else></th>\r\n                                            </tr>\r\n                                        </tbody>\r\n                                    </table>\r\n                                </div>\r\n                            </template>\r\n\r\n\r\n                            <div class="table-responsive p-3">\r\n                                <table class="table table">\r\n                                    <thead>\r\n                                        <tr>\r\n                                            <th>{{trans(\'finance.installment_total\')}}</th>\r\n                                            <th>{{trans(\'finance.other\')}}</th>\r\n                                            <th>{{trans(\'finance.paid\')}}</th>\r\n                                            <th>{{trans(\'finance.balance\')}}</th>\r\n                                        </tr>\r\n                                    </thead>\r\n                                    <tbody>\r\n                                        <tr>\r\n                                            <td>{{finalTotal}}</td>\r\n                                            <td>{{finalOther}}</td>\r\n                                            <td>{{finalPaid}}</td>\r\n                                            <td>{{finalBalance}}</td>\r\n                                        </tr>\r\n                                    </tbody>\r\n                                </table>\r\n                            </div>\r\n\r\n                            <div class="row justify-content-md-center" v-if="resetFeeOption && hasPermission(\'set-fee\')">\r\n                                <div class="col-4">\r\n                                    <button class="btn btn-danger btn-block" :key="student_record.id" v-confirm="{ok: confirmResetFee(student_record)}" v-tooltip="trans(\'student.reset_fee\')">{{trans(\'student.reset_fee\')}}</button>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <fee-payment-form v-if="feePaymentForm && hasNotAnyRole([\'parent\',\'student\']) && hasPermission(\'make-fee-payment\')" :uuid="uuid" :id="record_id" :fee-payment="feePayment" @completed="paymentMade" @closeFeePaymentForm="feePaymentForm = false"></fee-payment-form>\r\n        <fee-payment-parent-form v-if="feePaymentForm && hasAnyRole([\'parent\',\'student\']) && hasPermission(\'make-fee-payment\')" :uuid="uuid" :id="record_id" :fee-payment="feePayment" @completed="paymentMade" @closeFeePaymentForm="feePaymentForm = false"></fee-payment-parent-form>\r\n\r\n        <transition name="modal" v-if="feePaymentShow">\r\n            <div class="modal-mask">\r\n                <div class="modal-wrapper">\r\n                    <div class="modal-container modal-lg">\r\n                        <div class="modal-header">\r\n                            <slot name="header">\r\n                                {{trans(\'finance.fee_payment\')}}\r\n                                <span class="float-right pointer" @click="feePaymentShow = false">x</span>\r\n                            </slot>\r\n                        </div>\r\n                        <div class="modal-body">\r\n                            <slot name="body">\r\n                                <div style="max-height:600px;">\r\n                                    <fee-detail :uuid="uuid" :rid="record_id" :id="student_fee_record_id" @completed="getRecord"></fee-detail>\r\n                                    <div class="clearfix"></div>\r\n                                </div>\r\n                            </slot>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </transition>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n    import studentSummary from \'./../summary\'\r\n    import feePaymentForm from \'./payment\'\r\n    import feePaymentParentForm from \'./payment-parent\'\r\n    import feeDetail from \'./fee-detail\'\r\n\r\n    export default {\r\n        components : {studentSummary,feePaymentForm,feePaymentParentForm,feeDetail},\r\n        data() {\r\n            return {\r\n                uuid:this.$route.params.uuid,\r\n                record_id:this.$route.params.record_id,\r\n                student_record: {\r\n                    fee_allocation: {\r\n                        fee_allocation_groups: []\r\n                    }\r\n                },\r\n                feePayment: {\r\n                    fee_group_name: \'\',\r\n                    fee_payment_installment_id: \'\',\r\n                    student_fee_record_id: \'\',\r\n                    date: helper.today(),\r\n                    installments: [],\r\n                    amount: 0\r\n                },\r\n                fee: {\r\n                    groups: []\r\n                },\r\n                feePaymentForm: false,\r\n                feePaymentShow: false\r\n            };\r\n        },\r\n        mounted(){\r\n            if(!helper.hasPermission(\'list-student-fee\')){\r\n                helper.notAccessibleMsg();\r\n                this.$router.push(\'/dashboard\');\r\n            }\r\n\r\n            this.getRecord();\r\n            helper.showDemoNotification([\'student\']);\r\n        },\r\n        methods: {\r\n            hasPermission(permission){\r\n                return helper.hasPermission(permission);\r\n            },\r\n            hasAnyRole(roles){\r\n                return helper.hasAnyRole(roles);\r\n            },\r\n            hasNotAnyRole(roles){\r\n                return helper.hasNotAnyRole(roles);\r\n            },\r\n            getConfig(config){\r\n                return helper.getConfig(config);\r\n            },\r\n            getStudentName(student){\r\n                return helper.getStudentName(student);\r\n            },\r\n            getRecord(){\r\n                let loader = this.$loading.show();\r\n                this.feePaymentForm = false;\r\n                this.feePaymentShow = false;\r\n                axios.get(\'/api/student/\'+this.uuid+\'/fee/\'+this.record_id)\r\n                    .then(response => {\r\n                        this.student_record = response.student_record;\r\n\r\n                        if (! this.student_record.student_fee_records.length) {\r\n                            this.$router.push(\'/student/\'+this.uuid); \r\n                        }\r\n\r\n                        loader.hide();\r\n                    })\r\n                    .catch(error => {\r\n                        loader.hide();\r\n                        helper.showErrorMsg(error);\r\n                        if (this.hasAnyRole([\'student\',\'parent\'])) {\r\n                            this.$router.push(\'/student/list\')\r\n                        } else {\r\n                           this.$router.push(\'/student/\'+this.uuid+\'/fee/\'+this.record_id+\'/create\'); \r\n                        }\r\n                    });\r\n            },\r\n            calculate(){\r\n                this.fee = {\r\n                    groups: []\r\n                };\r\n                this.student_record.fee_allocation.fee_allocation_groups.forEach(fee_allocation_group => {\r\n                    let installments = [];\r\n                    let heads = [];\r\n                    let foots = [];\r\n                    heads.push(i18n.finance.fee_installment_title);\r\n                    heads.push(i18n.finance.fee_installment_due_date);\r\n\r\n                    fee_allocation_group.fee_group.fee_heads.forEach(fee_head => {\r\n                        heads.push(fee_head.name);\r\n                    });\r\n\r\n                    if (fee_allocation_group.fee_group.options.has_transport) {\r\n                        heads.push(i18n.transport.circle);\r\n                        heads.push(i18n.transport.fee);\r\n                    }\r\n\r\n                    foots.push(i18n.finance.total);\r\n                    foots.push(\'\');\r\n\r\n                    heads.push(i18n.finance.late_fee);\r\n                    heads.push(i18n.finance.installment_total);\r\n                    heads.push(i18n.finance.other);\r\n                    heads.push(i18n.finance.paid);\r\n                    heads.push(i18n.finance.balance);\r\n                    heads.push(i18n.finance.fee_status);\r\n\r\n                    fee_allocation_group.fee_installments.forEach(fee_installment => {\r\n                        let student_fee_record = this.student_record.student_fee_records.find(o => o.fee_installment_id == fee_installment.id);\r\n                        \r\n                        let installment_data = [];\r\n                        installment_data.push({\r\n                            text: fee_installment.title\r\n                        });\r\n                        installment_data.push({\r\n                            text: this.showDate(student_fee_record.due_date || fee_installment.due_date)\r\n                        });\r\n\r\n                        fee_allocation_group.fee_group.fee_heads.forEach(fee_head => {\r\n                            installment_data.push({\r\n                                text: this.getInstallmentFeeAmount(fee_installment, fee_head.id),\r\n                                actual: this.getInstallmentFeeAmountWithoutConcession(fee_installment, fee_head.id),\r\n                                is_concession: this.checkInstallmentConcession(fee_installment, fee_head.id) ? true : false\r\n                            });\r\n                        });\r\n\r\n                        if (fee_allocation_group.fee_group.options.has_transport) {\r\n                            installment_data.push({\r\n                                text: this.getTransportCircleName(fee_installment)\r\n                            });\r\n                            installment_data.push({\r\n                                text: this.getTransportFeeAmount(fee_installment)\r\n                            });\r\n                        }\r\n\r\n                        installment_data.push({\r\n                            text: this.getLateFeeAmount(fee_installment)\r\n                        });\r\n\r\n                        installment_data.push({\r\n                            text: this.getInstallmentTotalAmount(fee_installment)\r\n                        })\r\n\r\n                        installment_data.push({\r\n                            text: this.getInstallmentOtherAmount(fee_installment)\r\n                        })\r\n\r\n                        installment_data.push({\r\n                            text: this.getInstallmentPaidAmount(fee_installment)\r\n                        })\r\n\r\n                        installment_data.push({\r\n                            text: this.getInstallmentBalanceAmount(fee_installment)\r\n                        })\r\n\r\n                        installment_data.push({\r\n                            text: this.getInstallmentPrintStatus(fee_installment)\r\n                        })\r\n\r\n                        installments.push({\r\n                            data: installment_data\r\n                        });\r\n                    });\r\n\r\n                    fee_allocation_group.fee_group.fee_heads.forEach(fee_head => {\r\n                        foots.push(this.getTotalFee(fee_allocation_group, fee_head.id));\r\n                    });\r\n                    \r\n                    if (fee_allocation_group.fee_group.options.has_transport) {\r\n                        foots.push(\'\');\r\n                        foots.push(this.getTransportFeeTotal(fee_allocation_group));\r\n                    }\r\n                    \r\n                    foots.push(this.getLateFeeTotal(fee_allocation_group));\r\n                    foots.push(this.getInstallmentGrandTotal(fee_allocation_group));\r\n                    foots.push(this.getInstallmentGrandOther(fee_allocation_group));\r\n                    foots.push(this.getInstallmentPaidGrandTotal(fee_allocation_group));\r\n                    foots.push(this.getInstallmentBalanceGrandTotal(fee_allocation_group));\r\n                    foots.push(\'\');\r\n\r\n                    let group = {\r\n                        name: fee_allocation_group.fee_group.name,\r\n                        heads: heads,\r\n                        installments: installments,\r\n                        foots: foots,\r\n                    }\r\n                    this.fee.groups.push(group);\r\n                });\r\n            },\r\n            formatCurrency(amount){\r\n                return helper.formatCurrency(amount);\r\n            },\r\n            isInstallmentOverdue(fee_installment){\r\n                let installment = this.student_record.student_fee_records.find(o => o.fee_installment_id == fee_installment.id);\r\n\r\n                if (helper.today() > (installment.due_date || fee_installment.due_date) && installment.status != \'paid\') {\r\n                    return helper.getDateDiff(installment.due_date || fee_installment.due_date);\r\n                }\r\n\r\n                return 0;\r\n            },\r\n            getStatus(fee_installment) {\r\n                let installment = this.student_record.student_fee_records.find(o => o.fee_installment_id == fee_installment.id);\r\n                if (installment.status == \'paid\') {\r\n                    return \'<span class="label label-success">\'+i18n.student.fee_status_paid+\'</span>\';\r\n                } else if(installment.status == \'partially_paid\') {\r\n                    return \'<span class="label label-warning">\'+i18n.student.fee_status_partially_paid+\'</span>\';\r\n                } else if(installment.status == \'cancelled\') {\r\n                    return \'<span class="label label-danger">\'+i18n.student.fee_status_cancelled+\'</span>\';\r\n                } else {\r\n                    return \'<span class="label label-danger">\'+i18n.student.fee_status_unpaid+\'</span>\';\r\n                }\r\n            },\r\n            getInstallmentDueDate(fee_installment){\r\n                let installment = this.student_record.student_fee_records.find(o => o.fee_installment_id == fee_installment.id);\r\n\r\n                return helper.formatDate(installment.due_date || fee_installment.due_date);\r\n            },\r\n            getInstallmentStatus(fee_installment){\r\n                let installment = this.student_record.student_fee_records.find(o => o.fee_installment_id == fee_installment.id);\r\n\r\n                return installment.status;\r\n            },\r\n            getInstallmentFee(fee_installment, fee_head_id){\r\n                let amount = this.getInstallmentFeeWithoutConcession(fee_installment, fee_head_id);\r\n                return this.getInstallmentFeeWithConcession(amount, fee_installment, fee_head_id);\r\n            },\r\n            getInstallmentFeeWithoutConcession(fee_installment, fee_head_id){\r\n                let installment_detail = fee_installment.fee_installment_details.find(o => o.fee_head_id == fee_head_id);\r\n\r\n                if (typeof installment_detail == \'undefined\')\r\n                    return 0;\r\n\r\n                let student_fee_record = this.student_record.student_fee_records.find(o => o.fee_installment_id == fee_installment.id);\r\n                let student_optional_fee_record = student_fee_record.student_optional_fee_records.findIndex(o => o.fee_head_id == fee_head_id);\r\n\r\n                return (student_optional_fee_record < 0) ? installment_detail.amount : 0;\r\n            },\r\n            checkInstallmentConcession(fee_installment, fee_head_id){\r\n                let installment_detail = fee_installment.fee_installment_details.find(o => o.fee_head_id == fee_head_id);\r\n\r\n                let student_fee_record = this.student_record.student_fee_records.find(o => o.fee_installment_id == fee_installment.id);\r\n\r\n                let fee_concession_index = (student_fee_record.fee_concession) ? student_fee_record.fee_concession.fee_concession_details.findIndex(o => o.fee_head_id == fee_head_id) : -1;\r\n\r\n                return (fee_concession_index >= 0) ? true : false;\r\n            },\r\n            getInstallmentFeeWithConcession(amount, fee_installment, fee_head_id){\r\n                let installment_detail = fee_installment.fee_installment_details.find(o => o.fee_head_id == fee_head_id);\r\n\r\n                let student_fee_record = this.student_record.student_fee_records.find(o => o.fee_installment_id == fee_installment.id);\r\n\r\n                let fee_concession_index = (student_fee_record.fee_concession) ? student_fee_record.fee_concession.fee_concession_details.findIndex(o => o.fee_head_id == fee_head_id) : -1;\r\n\r\n                if (fee_concession_index >= 0) {\r\n                    let fee_concession = student_fee_record.fee_concession.fee_concession_details[fee_concession_index];\r\n\r\n                    let fee_concession_amount = fee_concession.type == \'percent\' ? (amount * (fee_concession.amount/100)) : fee_concession.amount;\r\n\r\n                    return ((amount - fee_concession_amount) >= 0) ? Math.ceil(amount - fee_concession_amount) : 0;\r\n                }\r\n\r\n                return Math.ceil(amount);\r\n            },\r\n            getInstallmentFeeAmountWithoutConcession(fee_installment, fee_head_id){\r\n                let amount = this.getInstallmentFeeWithoutConcession(fee_installment, fee_head_id);\r\n\r\n                return helper.formatCurrency(amount);\r\n            },\r\n            getInstallmentFeeAmount(fee_installment, fee_head_id){\r\n                let amount = this.getInstallmentFee(fee_installment, fee_head_id);\r\n                return helper.formatCurrency(amount);\r\n            },\r\n            getInstallmentTotalWithoutLateFee(fee_installment){\r\n                let student_fee_record = this.student_record.student_fee_records.find(o => o.fee_installment_id == fee_installment.id)\r\n\r\n                let total = 0;\r\n                fee_installment.fee_installment_details.forEach(installment_detail => {\r\n                    total += this.getInstallmentFee(fee_installment, installment_detail.fee_head_id);\r\n                });\r\n\r\n                let transport_fee = this.getTransportFee(fee_installment);\r\n\r\n                total += ((Number.isInteger(transport_fee)) ? transport_fee : 0);\r\n\r\n                return total;\r\n            },\r\n            getInstallmentTotal(fee_installment){\r\n                let student_fee_record = this.student_record.student_fee_records.find(o => o.fee_installment_id == fee_installment.id)\r\n                \r\n                let total = this.getInstallmentTotalWithoutLateFee(fee_installment);\r\n\r\n                if (total || student_fee_record.status != \'unpaid\') {\r\n                    let late_fee = this.getLateFee(fee_installment);\r\n                    total += ((Number.isInteger(late_fee)) ? late_fee : 0);\r\n                }\r\n\r\n                return total;\r\n            },\r\n            getInstallmentTotalAmount(fee_installment){\r\n                let amount = this.getInstallmentTotal(fee_installment);\r\n                return helper.formatCurrency(amount);\r\n            },\r\n            getInstallmentOther(fee_installment){\r\n                let student_fee_record = this.student_record.student_fee_records.find(o => o.fee_installment_id == fee_installment.id);\r\n\r\n                let other = 0;\r\n                student_fee_record.transactions.forEach(transaction => {\r\n                    if (! transaction.is_cancelled) {\r\n                        if (transaction.options.additional_fee_charge && transaction.options.additional_fee_charge.amount) {\r\n                            other += transaction.options.additional_fee_charge.amount;\r\n                        }\r\n                        if (transaction.options.additional_fee_discount && transaction.options.additional_fee_discount.amount) {\r\n                            other -= transaction.options.additional_fee_discount.amount;\r\n                        }\r\n                    }\r\n                });\r\n\r\n                return other;\r\n            },\r\n            getInstallmentOtherAmount(fee_installment){\r\n                let amount = this.getInstallmentOther(fee_installment);\r\n                return helper.formatCurrency(amount);\r\n            },\r\n            getInstallmentPaid(fee_installment){\r\n                let student_fee_record = this.student_record.student_fee_records.find(o => o.fee_installment_id == fee_installment.id);\r\n\r\n                let paid = 0;\r\n                student_fee_record.transactions.forEach(transaction => {\r\n                    if (! transaction.is_cancelled)\r\n                        paid += transaction.amount;\r\n                });\r\n\r\n                return paid;\r\n            },\r\n            getInstallmentPaidAmount(fee_installment){\r\n                let amount = this.getInstallmentPaid(fee_installment);\r\n                return helper.formatCurrency(amount);\r\n            },\r\n            getInstallmentBalance(fee_installment){\r\n                let total = this.getInstallmentTotal(fee_installment);\r\n                let other = this.getInstallmentOther(fee_installment);\r\n                let paid = this.getInstallmentPaid(fee_installment);\r\n                return total + other - paid;\r\n            },\r\n            getInstallmentBalanceAmount(fee_installment){\r\n                let amount = this.getInstallmentBalance(fee_installment);\r\n                return helper.formatCurrency(amount);\r\n            },\r\n            getTransportCircleName(fee_installment){\r\n                let installment = this.student_record.student_fee_records.find(o => o.fee_installment_id == fee_installment.id);\r\n                return installment.transport_circle ? installment.transport_circle.name : \'-\';\r\n            },\r\n            getTransportFee(fee_installment){\r\n                let installment = this.student_record.student_fee_records.find(o => o.fee_installment_id == fee_installment.id);\r\n\r\n                if (! installment.transport_circle_id || ! fee_installment.transport_fee_id)\r\n                    return \'-\';\r\n\r\n                let transport_fee = fee_installment.transport_fee.transport_fee_details.find(o => o.transport_circle_id == installment.transport_circle_id);\r\n                return transport_fee.amount;\r\n            },\r\n            getTransportFeeAmount(fee_installment){\r\n                let amount = this.getTransportFee(fee_installment);\r\n                return (Number.isInteger(amount)) ? helper.formatCurrency(amount) : \'-\';\r\n            },\r\n            getLateFeeAmount(fee_installment){\r\n                let amount = this.getLateFee(fee_installment);\r\n                return (Number.isInteger(amount)) ? helper.formatCurrency(amount) : \'-\';\r\n            },\r\n            getLateFee(fee_installment){\r\n                let installment_total = this.getInstallmentTotalWithoutLateFee(fee_installment);\r\n\r\n                if (! installment_total)\r\n                    return \'-\';\r\n\r\n                let date = helper.toDate(this.feePayment.date);\r\n\r\n                let installment = this.student_record.student_fee_records.find(o => o.fee_installment_id == fee_installment.id);\r\n\r\n                if (installment.status == \'paid\') {\r\n                    return installment.late_fee_charged;\r\n                }\r\n\r\n                if ((installment.late_fee_applicable == null && !fee_installment.late_fee_applicable) || installment.late_fee_applicable == 0)\r\n                    return \'-\';\r\n\r\n                if (date <= (installment.due_date || fee_installment.due_date))\r\n                    return \'-\';\r\n\r\n                let late_day = helper.getDateDiff((installment.due_date || fee_installment.due_date), date);\r\n\r\n                let per_period = Math.floor(late_day / (installment.late_fee_frequency || fee_installment.late_fee_frequency));\r\n                return (installment.late_fee || fee_installment.late_fee) * per_period;\r\n            },\r\n            showInstallmentDetail(fee_allocation_group, fee_installment){\r\n                this.feePayment.installments = [];\r\n                this.feePayment.fee_group_name = fee_allocation_group.fee_group.name;\r\n                let installments = fee_allocation_group.fee_installments.filter(o => o.due_date <= fee_installment.due_date);\r\n\r\n                let total = 0;\r\n                installments.forEach(installment => {\r\n                    let student_installment = this.student_record.student_fee_records.find(o => o.fee_installment_id == installment.id);\r\n                    if (student_installment.status == \'unpaid\' || student_installment.status == \'partially_paid\') {\r\n\r\n                        let installment_fee = this.getInstallmentTotalWithoutLateFee(installment);\r\n                        let other = this.getInstallmentOther(installment);\r\n                        let late_fee = this.getLateFee(installment);\r\n                        let paid = this.getInstallmentPaid(installment);\r\n                        installment_fee += other;\r\n\r\n                        let installment_balance = (installment_fee > paid) ? (installment_fee - paid) : 0\r\n                        if (installment_fee) {\r\n                            late_fee = ((Number.isInteger(late_fee)) ? late_fee : 0)\r\n                        }\r\n                        let late_fee_balance = (!installment_balance && late_fee) ? (late_fee - (paid - installment_fee)) : late_fee;\r\n\r\n                        let installment_total = installment_fee;\r\n                        if (installment_fee) {\r\n                            late_fee = ((Number.isInteger(late_fee)) ? late_fee : 0)\r\n                            installment_total += late_fee;\r\n                        }\r\n\r\n                        let balance = installment_total - paid;\r\n                        total += balance;\r\n\r\n                        this.feePayment.installments.push({\r\n                            fee_installment_id:  student_installment.fee_installment_id,\r\n                            title: installment.title,\r\n                            installment_fee: installment_fee,\r\n                            installment_balance: installment_balance,\r\n                            late_fee_balance: (Number.isInteger(late_fee_balance)) ? late_fee_balance : 0,\r\n                            late_fee: late_fee,\r\n                            paid: paid,\r\n                            total: balance\r\n                        })\r\n                    }\r\n                });\r\n                this.feePayment.amount = total;\r\n                this.feePayment.fee_payment_installment_id = fee_installment.id;\r\n                this.feePaymentForm = true;\r\n            },\r\n            getTotalFee(fee_allocation_group, fee_head_id){\r\n                let total = 0;\r\n                fee_allocation_group.fee_installments.forEach(fee_installment => {\r\n                    total += this.getInstallmentFee(fee_installment, fee_head_id);\r\n                });\r\n                return helper.formatCurrency(total);\r\n            },\r\n            getTransportFeeTotal(fee_allocation_group){\r\n                let total = 0;\r\n                fee_allocation_group.fee_installments.forEach(fee_installment => {\r\n                    let fee = this.getTransportFee(fee_installment);\r\n                    total += ((Number.isInteger(fee)) ? fee : 0);\r\n                });\r\n                return total ? this.formatCurrency(total) : \'-\';\r\n            },\r\n            getLateFeeTotal(fee_allocation_group){\r\n                let total = 0;\r\n                fee_allocation_group.fee_installments.forEach(fee_installment => {\r\n                    let fee = this.getLateFee(fee_installment);\r\n                    total += ((Number.isInteger(fee)) ? fee : 0);\r\n                });\r\n                return total ? this.formatCurrency(total) : \'-\';\r\n            },\r\n            getInstallmentGrandTotal(fee_allocation_group){\r\n                let amount = this.getInstallmentGrandTotalAmount(fee_allocation_group);\r\n                return (Number.isInteger(amount)) ? helper.formatCurrency(amount) : \'-\';\r\n            },\r\n            getInstallmentGrandTotalAmount(fee_allocation_group){\r\n                let total = 0;\r\n                fee_allocation_group.fee_installments.forEach(fee_installment => {\r\n                    total += this.getInstallmentTotal(fee_installment);\r\n                });\r\n                return total;\r\n            },\r\n            getInstallmentGrandOther(fee_allocation_group){\r\n                let amount = this.getInstallmentGrandOtherAmount(fee_allocation_group);\r\n                return (Number.isInteger(amount)) ? helper.formatCurrency(amount) : \'-\';\r\n            },\r\n            getInstallmentGrandOtherAmount(fee_allocation_group){\r\n                let other = 0;\r\n                fee_allocation_group.fee_installments.forEach(fee_installment => {\r\n                    other += this.getInstallmentOther(fee_installment);\r\n                });\r\n                return other;\r\n            },\r\n            getInstallmentPaidGrandTotal(fee_allocation_group){\r\n                let amount = this.getInstallmentPaidGrandTotalAmount(fee_allocation_group);\r\n                return (Number.isInteger(amount)) ? helper.formatCurrency(amount) : \'-\';\r\n            },\r\n            getInstallmentPaidGrandTotalAmount(fee_allocation_group){\r\n                let total = 0;\r\n                fee_allocation_group.fee_installments.forEach(fee_installment => {\r\n                    total += this.getInstallmentPaid(fee_installment);\r\n                });\r\n                return total;\r\n            },\r\n            getInstallmentBalanceGrandTotal(fee_allocation_group){\r\n                let amount = this.getInstallmentBalanceGrandTotalAmount(fee_allocation_group);\r\n                return (Number.isInteger(amount)) ? helper.formatCurrency(amount) : \'-\';\r\n            },\r\n            getInstallmentBalanceGrandTotalAmount(fee_allocation_group){\r\n                let total = 0;\r\n                fee_allocation_group.fee_installments.forEach(fee_installment => {\r\n                    total += this.getInstallmentBalance(fee_installment);\r\n                });\r\n                return total;\r\n            },\r\n            paymentMade(){\r\n                this.getRecord();\r\n            },\r\n            showDate(date){\r\n                return helper.formatDate(date);\r\n            },\r\n            getInstallmentPrintStatus(fee_installment){\r\n                let student_fee_record = this.student_record.student_fee_records.find(o => o.fee_installment_id == fee_installment.id);\r\n\r\n                if (student_fee_record.status == \'paid\')\r\n                    return i18n.student.fee_status_paid;\r\n                else if(student_fee_record.status == \'partially_paid\')\r\n                    return i18n.student.fee_status_partially_paid;\r\n                else if(student_fee_record.status == \'cancelled\')\r\n                    return i18n.student.fee_status_cancelled;\r\n                else if(student_fee_record.status == \'unpaid\')\r\n                    return i18n.student.fee_status_unpaid;\r\n            },\r\n            setTransaction(fee_installment) {\r\n                let student_fee_record = this.student_record.student_fee_records.find(o => o.fee_installment_id == fee_installment.id);\r\n                this.student_fee_record_id = student_fee_record.id;\r\n                this.feePaymentShow = true;\r\n            },\r\n            print(){\r\n                let loader = this.$loading.show();\r\n                this.calculate();\r\n                axios.post(\'/api/student/\'+this.uuid+\'/fee/\'+this.record_id+\'/print\',{fee: this.fee})\r\n                    .then(response => {\r\n                        let print = window.open("/print");\r\n                        loader.hide();\r\n                        print.document.write(response);\r\n                    })\r\n                    .catch(error => {\r\n                        loader.hide();\r\n                        helper.showErrorMsg(error);\r\n                    });\r\n            },\r\n            pdf(){\r\n                let loader = this.$loading.show();\r\n                this.calculate();\r\n                axios.post(\'/api/student/\'+this.uuid+\'/fee/\'+this.record_id+\'/pdf\',{fee: this.fee})\r\n                    .then(response => {\r\n                        loader.hide();\r\n                        window.open(\'/download/report/\'+response+\'?token=\'+this.authToken);\r\n                    })\r\n                    .catch(error => {\r\n                        loader.hide();\r\n                        helper.showErrorMsg(error);\r\n                    });\r\n            },\r\n            confirmEmptyReceiptDelete(fee_installment){\r\n                return dialog => this.deleteEmptyReceipt(fee_installment);\r\n            },\r\n            deleteEmptyReceipt(fee_installment){\r\n                let loader = this.$loading.show();\r\n                let student_fee_record = this.student_record.student_fee_records.find(o => o.fee_installment_id == fee_installment.id);\r\n                axios.post(\'/api/student/\'+this.uuid+\'/fee/\'+this.record_id+\'/\'+student_fee_record.id+\'/cancel\')\r\n                    .then(response => {\r\n                        toastr.success(response.message);\r\n                        this.getRecord();\r\n                        loader.hide();\r\n                    }).catch(error => {\r\n                        loader.hide();\r\n                        helper.showErrorMsg(error);\r\n                    });\r\n            },\r\n            confirmResetFee(student_record){\r\n                return dialog => this.resetFee(student_record);\r\n            },\r\n            resetFee(student_record){\r\n                let loader = this.$loading.show();\r\n                axios.patch(\'/api/student/\'+this.uuid+\'/fee/\'+this.record_id+\'/reset\')\r\n                    .then(response => {\r\n                        toastr.success(response.message);\r\n                        this.getRecord();\r\n                        loader.hide();\r\n                    }).catch(error => {\r\n                        loader.hide();\r\n                        helper.showErrorMsg(error);\r\n                    });\r\n            }\r\n        },\r\n        filters: {\r\n          moment(date) {\r\n            return helper.formatDate(date);\r\n          },\r\n          momentDateTime(date) {\r\n            return helper.formatDateTime(date);\r\n          }\r\n        },\r\n        computed: {\r\n            authToken(){\r\n                return helper.getAuthToken();\r\n            },\r\n            resetFeeOption(){\r\n                if (! this.student_record.id)\r\n                    return false;\r\n\r\n                return this.student_record.student_fee_records.every(student_fee_record => {\r\n                    return student_fee_record.status == \'unpaid\';\r\n                });\r\n            },\r\n            finalTotal() {\r\n                let total = 0;\r\n                this.student_record.fee_allocation.fee_allocation_groups.forEach(fee_allocation_group => {\r\n                    total += this.getInstallmentGrandTotalAmount(fee_allocation_group);\r\n                });\r\n                return helper.formatCurrency(total);\r\n            },\r\n            finalOther() {\r\n                let total = 0;\r\n                this.student_record.fee_allocation.fee_allocation_groups.forEach(fee_allocation_group => {\r\n                    total += this.getInstallmentGrandOtherAmount(fee_allocation_group);\r\n                });\r\n                return helper.formatCurrency(total);\r\n            },\r\n            finalPaid() {\r\n                let total = 0;\r\n                this.student_record.fee_allocation.fee_allocation_groups.forEach(fee_allocation_group => {\r\n                    total += this.getInstallmentPaidGrandTotalAmount(fee_allocation_group);\r\n                });\r\n                return helper.formatCurrency(total);\r\n            },\r\n            finalBalance() {\r\n                let total = 0;\r\n                this.student_record.fee_allocation.fee_allocation_groups.forEach(fee_allocation_group => {\r\n                    total += this.getInstallmentBalanceGrandTotalAmount(fee_allocation_group);\r\n                });\r\n                return helper.formatCurrency(total);\r\n            }\r\n        },\r\n        watch: {\r\n            \'$route.params.uuid\': function (uuid) {\r\n                this.uuid = uuid;\r\n                this.record_id = this.$route.params.record_id;\r\n                this.getRecord()\r\n            }\r\n        }\r\n    }\r\n<\/script>\r\n\r\n<style>\r\n.loading-overlay.is-full-page{\r\n    z-index: 1060;\r\n}\r\n</style>'],sourceRoot:""}]);const o=i},72371:(e,t,n)=>{n.d(t,{Z:()=>o});var a=n(94015),r=n.n(a),s=n(23645),i=n.n(s)()(r());i.push([e.id,".loading-overlay.is-full-page{z-index:1060}","",{version:3,sources:["webpack://./resources/js/views/student/fee/payment-parent.vue"],names:[],mappings:"AA8cA,8BACA,YACA",sourcesContent:['<template>\r\n    <transition name="modal">\r\n        <div class="modal-mask">\r\n            <div class="modal-wrapper">\r\n                <div class="modal-container modal-lg">\r\n                    <div class="modal-header">\r\n                        <slot name="header">\r\n                            {{trans(\'finance.fee_payment\')}}\r\n                            <span class="float-right pointer" @click="$emit(\'closeFeePaymentForm\')">x</span>\r\n                        </slot>\r\n                    </div>\r\n                    <div class="modal-body">\r\n                        <slot name="body">\r\n                            <h4>{{feePayment.fee_group_name}} <span class="pull-right">{{feePayment.date | moment}}</span></h4>\r\n                            <div style="max-height:600px;">\r\n                                <form @submit.prevent="submit" @keydown="feePaymentForm.errors.clear($event.target.name)">\r\n                                    <div class="table-responsive p-2">\r\n                                        <table class="table table-bordered">\r\n                                            <thead>\r\n                                                <tr>\r\n                                                    <th>{{trans(\'finance.fee_installment\')}}</th>\r\n                                                    <th class="text-right">{{trans(\'finance.installment_total\')}}</th>\r\n                                                    <th class="text-right">{{trans(\'finance.late_fee\')}}</th>\r\n                                                    <th class="text-right">{{trans(\'general.total\')}}</th>\r\n                                                </tr>\r\n                                            </thead>\r\n                                            <tbody>\r\n                                                <tr v-for="installment in feePaymentForm.installments">\r\n                                                    <td v-text="installment.title"></td>\r\n                                                    <td class="text-right" v-text="installment.installment_balance"></td>\r\n                                                    <td class="text-right">\r\n                                                        {{installment.late_fee_balance}}\r\n                                                    </td>\r\n                                                    <td class="text-right" v-text="getInstallmentTotal(installment)"></td>\r\n                                                </tr>\r\n                                            </tbody>\r\n                                            <tfoot>\r\n                                                <tr>\r\n                                                    <th>{{trans(\'general.total\')}}</th>\r\n                                                    <th colspan="2"></th>\r\n                                                    <th class="text-right">{{formatCurrency(getGrandTotal)}}</th>\r\n                                                </tr>\r\n                                            </tfoot>\r\n                                        </table>\r\n                                    </div>\r\n                                    <div>\r\n                                        <h4 class="card-title">{{trans(\'finance.choose_payment_gateway\')}}</h4>\r\n                                        <div class="radio radio-success" v-if="getConfig(\'razorpay\') && razorpay_loaded">\r\n                                            <input type="radio" name="payment_gateway" id="razorpay" value="razorpay" @change="setPaymentGateway(\'razorpay\')">\r\n                                            <label for="razorpay"> \r\n                                                Razorpay \r\n                                            </label>\r\n                                        </div>\r\n                                        <div class="radio radio-success" v-if="getConfig(\'billdesk\')">\r\n                                            <input type="radio" name="payment_gateway" id="billdesk" value="billdesk" @change="setPaymentGateway(\'billdesk\')">\r\n                                            <label for="billdesk"> Billdesk </label>\r\n                                        </div>\r\n                                        <div class="radio radio-success" v-if="getConfig(\'stripe\')">\r\n                                            <input type="radio" name="payment_gateway" id="stripe" value="stripe" @change="setPaymentGateway(\'stripe\')">\r\n                                            <label for="stripe"> Stripe </label>\r\n                                        </div>\r\n                                        <div class="radio radio-success" v-if="getConfig(\'paystack\')">\r\n                                            <input type="radio" name="payment_gateway" id="paystack" value="paystack" @change="setPaymentGateway(\'paystack\')">\r\n                                            <label for="paystack"> Paystack </label>\r\n                                        </div>\r\n                                        <div class="radio radio-success" v-if="getConfig(\'paypal\')">\r\n                                            <input type="radio" name="payment_gateway" id="paypal" value="paypal" @change="setPaymentGateway(\'paypal\')">\r\n                                            <label for="paypal"> Paypal </label>\r\n                                        </div>\r\n\r\n                                        <p>{{handlingFeeAmount}}</p>\r\n                                        <p>{{totalAmount}}</p>\r\n\r\n                                        <template v-if="payment_gateway == \'billdesk\'">\r\n                                            <button type="button" class="btn btn-info" @click="callBillDesk">{{trans(\'general.proceed\')}}</button>\r\n                                        </template>\r\n\r\n                                        <template v-if="payment_gateway == \'razorpay\'">\r\n                                            <button type="button" class="btn btn-info" @click="callRazorpay">{{trans(\'general.proceed\')}}</button>\r\n                                        </template>\r\n\r\n                                        <template v-if="payment_gateway == \'paystack\'">\r\n                                            <button type="button" class="btn btn-info" @click="payWithPaystack">{{trans(\'general.proceed\')}}</button>\r\n                                        </template>\r\n\r\n                                        <template v-if="payment_gateway == \'paypal\'">\r\n                                            <button type="button" class="btn btn-info" @click="callPaypal" v-if="paypalButton">{{trans(\'general.proceed\')}}</button>\r\n                                        </template>\r\n\r\n                                        <template v-if="payment_gateway == \'stripe\'">\r\n                                            <div class="row m-t-40">\r\n                                                <div class="col-12">\r\n                                                    <div class="form-group">\r\n                                                        <input class="form-control" type="number" maxlength="16" value="" v-model="stripe.card_number" :placeholder="trans(\'finance.card_number\')">\r\n                                                    </div>\r\n                                                </div>\r\n                                                <div class="col-3">\r\n                                                    <div class="form-group">\r\n                                                        <input class="form-control" type="number" value="" v-model="stripe.month" :placeholder="trans(\'finance.card_expiry_month\')">\r\n                                                    </div>\r\n                                                </div>\r\n                                                <div class="col-4">\r\n                                                    <div class="form-group">\r\n                                                        <input class="form-control" type="number" value="" v-model="stripe.year" :placeholder="trans(\'finance.card_expiry_year\')">\r\n                                                    </div>\r\n                                                </div>\r\n                                                <div class="col-1">\r\n                                                </div>\r\n                                                <div class="col-4">\r\n                                                    <div class="form-group">\r\n                                                        <input class="form-control" type="number" value="" v-model="stripe.cvc" :placeholder="trans(\'finance.card_cvc\')">\r\n                                                    </div>\r\n                                                </div>\r\n                                            </div>\r\n                                            <button type="button" @click="stripeCheckout" class="btn btn-info waves-effect waves-light pull-right" v-if="stripeButton"><span>{{trans(\'general.proceed\')}}</span></button>\r\n                                        </template>\r\n                                    </div>\r\n                                </form>\r\n                            </div>\r\n                        </slot>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </transition>\r\n</template>\r\n\r\n<script>\r\n    export default {\r\n        components: {},\r\n        props: [\'id\',\'uuid\',\'feePayment\'],\r\n        data() {\r\n            return {\r\n                default_currency: helper.getConfig(\'default_currency\'),\r\n                payment_gateway: \'\',\r\n                razorpay_loaded: 0,\r\n                stripe_loaded: 0,\r\n                total: 0,\r\n                stripe: {\r\n                    card_number: \'\',\r\n                    month: \'\',\r\n                    year: \'\',\r\n                    cvc: \'\'\r\n                },\r\n                stripeButton: true,\r\n                paypalButton: true,\r\n                feePaymentForm: new Form({\r\n                    amount: 0,\r\n                    installment_id: \'\',\r\n                    date: \'\',\r\n                    installments: []\r\n                })\r\n            }\r\n        },\r\n        mounted(){\r\n            this.loadFeePayment(this.feePayment);\r\n\r\n            if ((this.default_currency.name == \'INR\' || !helper.getConfig(\'mode\')) && this.getConfig(\'razorpay\')) {\r\n                this.injectRazorpay();\r\n            }\r\n        },\r\n        methods: {\r\n            getConfig(config){\r\n                return helper.getConfig(config);\r\n            },\r\n            loadFeePayment(feePayment){\r\n                this.feePaymentForm.amount = feePayment.amount;\r\n                this.feePaymentForm.installment_id = feePayment.fee_payment_installment_id;\r\n                this.feePaymentForm.date = feePayment.date;\r\n                this.feePaymentForm.installments = [];\r\n                this.total = 0;\r\n                feePayment.installments.forEach(installment => {\r\n                    this.feePaymentForm.installments.push({\r\n                        fee_installment_id: installment.fee_installment_id,\r\n                        title: installment.title,\r\n                        installment_balance: installment.installment_balance,\r\n                        late_fee_balance: installment.late_fee_balance\r\n                    });\r\n                })\r\n            },\r\n            getInstallmentTotal(installment){\r\n                return (installment.installment_balance + parseInt(installment.late_fee_balance));\r\n            },\r\n            formatCurrency(amount){\r\n                return helper.formatCurrency(amount);\r\n            },\r\n            setPaymentGateway(gateway){\r\n                this.payment_gateway = gateway;\r\n            },\r\n            stripeCheckout(){\r\n                let loader = this.$loading.show();\r\n                this.stripeButton = false;\r\n                Stripe.setPublishableKey(this.getConfig(\'stripe_publishable_key\'));\r\n                Stripe.card.createToken({\r\n                    number: this.stripe.card_number,\r\n                    cvc: this.stripe.cvc,\r\n                    exp_month: this.stripe.month,\r\n                    exp_year: this.stripe.year\r\n                }, this.stripeResponseHandler);\r\n                loader.hide();\r\n            },\r\n            stripeResponseHandler(status, response) {\r\n                if(status == 200){\r\n                    let loader = this.$loading.show();\r\n                    axios.post(\'/api/student/\'+this.uuid+\'/payment/\'+this.id+\'/stripe\',{\r\n                            stripeToken: response.id,\r\n                            amount: this.total * 100,\r\n                            fee: this.feePaymentForm.amount,\r\n                            handling_fee: this.handlingFee,\r\n                            fee_installment_id: this.feePaymentForm.installment_id,\r\n                            installments: this.feePaymentForm.installments\r\n                        })\r\n                        .then(response => {\r\n                            loader.hide();\r\n                            toastr.success(response.message);\r\n                            this.$emit(\'completed\');\r\n                            this.stripeButton = true;\r\n                        })\r\n                        .catch(error => {\r\n                            loader.hide();\r\n                            helper.showErrorMsg(error);\r\n                            this.stripeButton = true;\r\n                        })\r\n                } else {\r\n                    toastr.error(response.error.message);\r\n                    this.stripeButton = true;\r\n                }\r\n            },\r\n            injectRazorpay() {\r\n                let vm = this;\r\n                var result = $.Deferred(),\r\n                script = document.createElement("script");\r\n\r\n                script.async = "async";\r\n                script.type = "text/javascript";\r\n                script.src = \'https://checkout.razorpay.com/v1/checkout.js\';\r\n                script.onload = script.onreadystatechange = function(_, isAbort) {\r\n                    if (!script.readyState || /loaded|complete/.test(script.readyState)) {\r\n                        if (isAbort)\r\n                            result.reject();\r\n                        else \r\n                            result.resolve();\r\n                    }\r\n                    vm.razorpay_loaded = 1;\r\n                };\r\n\r\n                script.onerror = function() {\r\n                    result.reject();\r\n                };\r\n\r\n                document.head.appendChild(script);\r\n\r\n                return result.promise();\r\n            },\r\n            callRazorpay(){\r\n                let vm = this;\r\n                var options = {\r\n                    key: this.getConfig(\'razorpay_key\'),\r\n                    protocol: \'https\',\r\n                    hostname: \'api.razorpay.com\',\r\n                    amount: this.total * 100,\r\n                    name: helper.getConfig(\'institute_name\'),\r\n                    description: i18n.finance.fee_payment,\r\n                    image: this.getLogo,\r\n                    prefill: {\r\n                        email: "",\r\n                        contact: "",\r\n                        name: ""\r\n                    },\r\n                    notes:{\r\n                        student_record_id: this.id,\r\n                        fee: this.feePaymentForm.amount,\r\n                        handling_fee: this.handlingFee\r\n                    },\r\n                    handler: function (transaction, response){\r\n                        vm.completeRazorpay(transaction.razorpay_payment_id)\r\n                    }\r\n                };\r\n\r\n                window.rzpay = new Razorpay(options);\r\n                rzpay.open();\r\n            },\r\n            completeRazorpay(transaction_id){\r\n                let loader = this.$loading.show();\r\n                axios.post(\'/api/student/\'+this.uuid+\'/payment/\'+this.id+\'/rzp\',{\r\n                        transaction_id: transaction_id,\r\n                        installments: this.feePaymentForm.installments,\r\n                        fee_installment_id: this.feePaymentForm.installment_id\r\n                    })\r\n                    .then(response => {\r\n                        loader.hide();\r\n                        toastr.success(response.message);\r\n                        this.$emit(\'completed\');\r\n                    })\r\n                    .catch(error => {\r\n                        loader.hide();\r\n                        helper.showErrorMsg(error);\r\n                    })\r\n            },\r\n            callBillDesk() {\r\n                let loader = this.$loading.show();\r\n\r\n                axios.post(\'student/\'+this.uuid+\'/payment/\'+this.id+\'/billdesk\', {\r\n                    amount: this.feePaymentForm.amount,\r\n                    installment_id: this.feePaymentForm.installment_id,\r\n                    installments: this.feePaymentForm.installments\r\n                })\r\n                .then(response => {\r\n                    loader.hide();\r\n\r\n                    bdPayment.initialize({\r\n                        msg : response.msg,\r\n                        callbackUrl: response.url,\r\n                        options : {\r\n                            enableChildWindowPosting : true,\r\n                            enablePaymentRetry : true,\r\n                            retry_attempt_count: 3\r\n                        }\r\n                    }); \r\n                })\r\n                .catch(error => {\r\n                    loader.hide();\r\n                    helper.showErrorMsg(error);\r\n                })\r\n            },\r\n            callPaypal(){\r\n                this.paypalButton = false;\r\n                let loader = this.$loading.show();\r\n                axios.post(\'/api/student/\'+this.uuid+\'/payment/\'+this.id+\'/paypal\',{\r\n                        amount: this.total,\r\n                        fee: this.feePaymentForm.amount,\r\n                        handling_fee: this.handlingFee,\r\n                        fee_installment_id: this.feePaymentForm.installment_id,\r\n                        installments: this.feePaymentForm.installments\r\n                    })\r\n                    .then(response => {\r\n                        loader.hide();\r\n                        window.location = response;\r\n                    })\r\n                    .catch(error => {\r\n                        loader.hide();\r\n                        this.paypalButton = true\r\n                        helper.showErrorMsg(error);\r\n                    })\r\n                ;\r\n            },\r\n            payWithPaystack(){\r\n                if (helper.getConfig(\'default_currency\').name != \'NGN\' && helper.getConfig(\'default_currency\').name != \'GHS\') {\r\n                    toastr.error(i18n.configuration.currency_not_supported);\r\n                    return;\r\n                }\r\n\r\n                let vm = this;\r\n                var handler = PaystackPop.setup({\r\n                    key: this.getConfig(\'paystack_public_key\'),\r\n                    email: helper.getAuthUser(\'email\'),\r\n                    amount: this.total * 100,\r\n                    currency: helper.getConfig(\'default_currency\').name,\r\n                    ref: \'\'+Math.floor((Math.random() * 1000000000) + 1),\r\n                    metadata: {\r\n                        custom_fields: [\r\n                            {\r\n                                display_name: \'Student ID\',\r\n                                variable_name: "student_record_id",\r\n                                value: this.id\r\n                            },\r\n                            {\r\n                                display_name: \'Amount\',\r\n                                variable_name: "fee",\r\n                                value: this.feePaymentForm.amount\r\n                            },\r\n                            {\r\n                                display_name: \'Handling Fee\',\r\n                                variable_name: "handling_fee",\r\n                                value: this.handlingFee\r\n                            }\r\n                        ]\r\n                    },\r\n                    callback: function(response){\r\n                        vm.completePaystack(response.reference)\r\n                    },\r\n                    onClose: function(){\r\n                        \r\n                    }\r\n                });\r\n                handler.openIframe();\r\n            },\r\n            completePaystack(transaction_id){\r\n                let loader = this.$loading.show();\r\n                axios.post(\'/api/student/\'+this.uuid+\'/payment/\'+this.id+\'/paystack\',{\r\n                        transaction_id: transaction_id,\r\n                        installments: this.feePaymentForm.installments,\r\n                        fee_installment_id: this.feePaymentForm.installment_id\r\n                    })\r\n                    .then(response => {\r\n                        loader.hide();\r\n                        toastr.success(response.message);\r\n                        this.$emit(\'completed\');\r\n                    })\r\n                    .catch(error => {\r\n                        loader.hide();\r\n                        helper.showErrorMsg(error);\r\n                    })\r\n            }\r\n        },\r\n        computed: {\r\n            getLogo(){\r\n                return helper.getLogo();\r\n            },\r\n            handlingFee(){\r\n                let handling_fee = 0;\r\n\r\n                if (!this.payment_gateway)\r\n                    return handling_fee;\r\n\r\n                if (! helper.getConfig(this.payment_gateway+\'_charge_handling_fee\'))\r\n                    return handling_fee;\r\n\r\n                if(helper.getConfig(this.payment_gateway+\'_fixed_handling_fee\'))\r\n                    handling_fee = helper.getConfig(this.payment_gateway+\'_handling_fee\');\r\n                else {\r\n                    let percentage = helper.getConfig(this.payment_gateway+\'_handling_fee\');\r\n                    handling_fee = this.feePaymentForm.amount * (percentage / 100);\r\n                }\r\n\r\n                return helper.formatNumber(handling_fee);\r\n            },\r\n            handlingFeeAmount(){\r\n                if (! helper.getConfig(this.payment_gateway+\'_charge_handling_fee\'))\r\n                    return;\r\n\r\n                return i18n.finance.handling_fee+\' \'+helper.formatCurrency(this.handlingFee);\r\n            },\r\n            totalAmount(){\r\n                return i18n.finance.payable_amount+\' \'+helper.formatCurrency(this.total);\r\n            },\r\n            getGrandTotal(){\r\n                let total = 0;\r\n                total = total;\r\n\r\n                if(!Array.isArray(this.feePaymentForm.installments))\r\n                    return total;\r\n\r\n                this.feePaymentForm.installments.forEach(installment => {\r\n                    total += (installment.installment_balance + parseInt(installment.late_fee_balance));\r\n                })  \r\n                total = (total) ? (total + this.handlingFee) : total;\r\n                this.total = total; \r\n                return total;\r\n            }\r\n        },\r\n        filters: {\r\n          moment(date) {\r\n            return helper.formatDate(date);\r\n          },\r\n          momentDateTime(date) {\r\n            return helper.formatDateTime(date);\r\n          }\r\n        }\r\n    }\r\n<\/script>\r\n<style>\r\n.loading-overlay.is-full-page{\r\n    z-index: 1060;\r\n}\r\n</style>'],sourceRoot:""}]);const o=i},42437:(e,t,n)=>{n.r(t),n.d(t,{default:()=>b});var a=n(22846);const r={components:{},props:["id","uuid","feePayment"],data:function(){return{feePaymentForm:new Form({amount:0,additional_fee_discount:0,additional_fee_charge:0,additional_fee_charge_label:"",additional_fee_discount_label:"",installments:[],installment_id:"",account_id:"",payment_method_id:"",date:"",instrument_date:"",instrument_number:"",instrument_clearing_date:"",instrument_bank_detail:"",reference_number:"",remarks:""}),total:0,selected_account:null,accounts:[],payment_methods:[],selected_payment_method:null,payment_method_details:[],payment_method_detail:{}}},mounted:function(){this.loadFeePayment(this.feePayment),this.getPreRequisite()},methods:{hasPermission:function(e){return helper.hasPermission(e)},loadFeePayment:function(e){var t=this;this.feePaymentForm.date=e.date,this.feePaymentForm.installment_id=e.fee_payment_installment_id,this.feePaymentForm.amount=e.amount,this.total=0,this.feePaymentForm.installments=[],e.installments.forEach((function(e){t.feePaymentForm.installments.push({fee_installment_id:e.fee_installment_id,title:e.title,installment_balance:e.installment_balance,late_fee_balance:e.late_fee_balance})}))},getInstallmentTotal:function(e){return e.installment_balance+parseInt(e.late_fee_balance)},getPreRequisite:function(){var e=this,t=this.$loading.show();axios.get("/api/student/fee/pre-requisite").then((function(n){e.accounts=n.accounts,e.payment_methods=n.payment_methods,e.payment_method_details=n.payment_method_details,t.hide()})).catch((function(e){t.hide(),helper.showErrorMsg(e)}))},getPaymentMethodDetail:function(e){return helper.getPaymentMethodDetail(this.payment_method_detail,e)},onAccountSelect:function(e){this.feePaymentForm.account_id=e.id},onPaymentMethodSelect:function(e){this.feePaymentForm.payment_method_id=e.id,this.payment_method_detail=this.payment_method_details.find((function(t){return t.id==e.id}))},onPaymentMethodRemove:function(e){this.feePaymentForm.payment_method_id="",this.payment_method_detail=null},formatCurrency:function(e){return helper.formatCurrency(e)},submit:function(){var e=this,t=this.$loading.show();this.feePaymentForm.post("/api/student/"+this.uuid+"/payment/"+this.id).then((function(n){toastr.success(n.message),e.$emit("completed"),e.selected_account=null,e.selected_payment_method=null,e.feePaymentForm.installments=[],t.hide()})).catch((function(e){t.hide(),helper.showErrorMsg(e)}))}},computed:{getGrandTotal:function(){var e=0;return Array.isArray(this.feePaymentForm.installments)?(this.feePaymentForm.installments.forEach((function(t){e+=t.installment_balance+parseInt(t.late_fee_balance)})),e+ +this.feePaymentForm.additional_fee_charge-+this.feePaymentForm.additional_fee_discount):e}},watch:{feePayment:function(e){this.loadFeePayment(e)},getGrandTotal:function(e){this.feePaymentForm.amount=e}},filters:{moment:function(e){return helper.formatDate(e)},momentDateTime:function(e){return helper.formatDateTime(e)}}};var s=n(51900);const i=(0,s.Z)(r,(function(){var e=this,t=e._self._c;return t("transition",{attrs:{name:"modal"}},[t("div",{staticClass:"modal-mask"},[t("div",{staticClass:"modal-wrapper"},[t("div",{staticClass:"modal-container modal-lg"},[t("div",{staticClass:"modal-header"},[e._t("header",(function(){return[e._v("\n                        "+e._s(e.trans("finance.fee_payment"))+"\n                        "),t("span",{staticClass:"float-right pointer",on:{click:function(t){return e.$emit("closeFeePaymentForm")}}},[e._v("x")])]}))],2),e._v(" "),t("div",{staticClass:"modal-body"},[e._t("body",(function(){return[t("h4",[e._v(e._s(e.feePayment.fee_group_name)+" "),t("span",{staticClass:"pull-right"},[e._v(e._s(e._f("moment")(e.feePayment.date)))])]),e._v(" "),t("div",{staticStyle:{"max-height":"600px"}},[t("form",{on:{submit:function(t){return t.preventDefault(),e.submit.apply(null,arguments)},keydown:function(t){return e.feePaymentForm.errors.clear(t.target.name)}}},[t("div",{staticClass:"table-responsive p-2"},[t("table",{staticClass:"table table-bordered"},[t("thead",[t("tr",[t("th",[e._v(e._s(e.trans("finance.fee_installment")))]),e._v(" "),t("th",{staticClass:"text-right"},[e._v(e._s(e.trans("finance.installment_total")))]),e._v(" "),t("th",{staticClass:"text-right"},[e._v(e._s(e.trans("finance.late_fee")))]),e._v(" "),t("th",{staticClass:"text-right"},[e._v(e._s(e.trans("general.total")))])])]),e._v(" "),t("tbody",e._l(e.feePaymentForm.installments,(function(n){return t("tr",[t("td",{domProps:{textContent:e._s(n.title)}}),e._v(" "),t("td",{staticClass:"text-right",domProps:{textContent:e._s(n.installment_balance)}}),e._v(" "),t("td",{staticClass:"text-right"},[e.hasPermission("customize-late-fee")?[t("input",{directives:[{name:"model",rawName:"v-model",value:n.late_fee_balance,expression:"installment.late_fee_balance"}],staticClass:"invoice-input",attrs:{type:"text"},domProps:{value:n.late_fee_balance},on:{input:function(t){t.target.composing||e.$set(n,"late_fee_balance",t.target.value)}}})]:[e._v("\n                                                        "+e._s(n.late_fee_balance)+"\n                                                    ")]],2),e._v(" "),t("td",{staticClass:"text-right",domProps:{textContent:e._s(e.getInstallmentTotal(n))}})])})),0),e._v(" "),t("tfoot",[t("tr",[t("td",[e._v(e._s(e.trans("student.additional_fee_charge")))]),e._v(" "),t("td",{attrs:{colspan:"2"}},[t("div",{staticClass:"form-group"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.feePaymentForm.additional_fee_charge_label,expression:"feePaymentForm.additional_fee_charge_label"}],staticClass:"invoice-input-left",attrs:{type:"text",name:"additional_fee_charge_label",placeholder:e.trans("student.fee_label")},domProps:{value:e.feePaymentForm.additional_fee_charge_label},on:{input:function(t){t.target.composing||e.$set(e.feePaymentForm,"additional_fee_charge_label",t.target.value)}}}),e._v(" "),t("show-error",{attrs:{"form-name":e.feePaymentForm,"prop-name":"additional_fee_charge_label"}})],1)]),e._v(" "),t("td",{staticClass:"text-right"},[t("div",{staticClass:"form-group"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.feePaymentForm.additional_fee_charge,expression:"feePaymentForm.additional_fee_charge"}],staticClass:"invoice-input",attrs:{type:"text",name:"additional_fee_charge",placeholder:e.trans("student.additional_fee_charge")},domProps:{value:e.feePaymentForm.additional_fee_charge},on:{input:function(t){t.target.composing||e.$set(e.feePaymentForm,"additional_fee_charge",t.target.value)}}}),e._v(" "),t("show-error",{attrs:{"form-name":e.feePaymentForm,"prop-name":"additional_fee_charge"}})],1)])]),e._v(" "),t("tr",[t("td",[e._v(e._s(e.trans("student.additional_fee_discount")))]),e._v(" "),t("td",{attrs:{colspan:"2"}},[t("div",{staticClass:"form-group"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.feePaymentForm.additional_fee_discount_label,expression:"feePaymentForm.additional_fee_discount_label"}],staticClass:"invoice-input-left",attrs:{type:"text",name:"additional_fee_discount_label",placeholder:e.trans("student.fee_label")},domProps:{value:e.feePaymentForm.additional_fee_discount_label},on:{input:function(t){t.target.composing||e.$set(e.feePaymentForm,"additional_fee_discount_label",t.target.value)}}}),e._v(" "),t("show-error",{attrs:{"form-name":e.feePaymentForm,"prop-name":"additional_fee_discount_label"}})],1)]),e._v(" "),t("td",{staticClass:"text-right"},[t("div",{staticClass:"form-group"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.feePaymentForm.additional_fee_discount,expression:"feePaymentForm.additional_fee_discount"}],staticClass:"invoice-input",attrs:{type:"text",name:"additional_fee_discount",placeholder:e.trans("student.additional_fee_discount")},domProps:{value:e.feePaymentForm.additional_fee_discount},on:{input:function(t){t.target.composing||e.$set(e.feePaymentForm,"additional_fee_discount",t.target.value)}}}),e._v(" "),t("show-error",{attrs:{"form-name":e.feePaymentForm,"prop-name":"additional_fee_discount"}})],1)])]),e._v(" "),t("tr",[t("th",[e._v(e._s(e.trans("general.total")))]),e._v(" "),t("th",{attrs:{colspan:"2"}}),e._v(" "),t("th",{staticClass:"text-right"},[e._v(e._s(e.formatCurrency(e.getGrandTotal)))])]),e._v(" "),e.hasPermission("make-partial-fee-payment")?t("tr",[t("th",[e._v(e._s(e.trans("finance.amount")))]),e._v(" "),t("th",{attrs:{colspan:"2"}}),e._v(" "),t("th",{staticClass:"text-right"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.feePaymentForm.amount,expression:"feePaymentForm.amount"}],staticClass:"invoice-input",attrs:{type:"text",name:"amount",placeholder:e.trans("finance.amount")},domProps:{value:e.feePaymentForm.amount},on:{input:function(t){t.target.composing||e.$set(e.feePaymentForm,"amount",t.target.value)}}}),e._v(" "),t("show-error",{attrs:{"form-name":e.feePaymentForm,"prop-name":"amount"}})],1)]):e._e()])])]),e._v(" "),t("div",{staticClass:"row"},[e.feePaymentForm.amount?[t("div",{staticClass:"col-12 col-sm-6"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:""}},[e._v(e._s(e.trans("finance.account")))]),e._v(" "),t("v-select",{attrs:{label:"name",name:"account_id",id:"account_id",options:e.accounts,placeholder:e.trans("account.select_account")},on:{select:e.onAccountSelect,close:function(t){return e.feePaymentForm.errors.clear("account_id")},remove:function(t){e.feePaymentForm.account_id=""}},model:{value:e.selected_account,callback:function(t){e.selected_account=t},expression:"selected_account"}},[e.accounts.length?e._e():t("div",{staticClass:"multiselect__option",attrs:{slot:"afterList"},slot:"afterList"},[e._v("\n                                                        "+e._s(e.trans("general.no_option_found"))+"\n                                                    ")])]),e._v(" "),t("show-error",{attrs:{"form-name":e.feePaymentForm,"prop-name":"account_id"}})],1)]),e._v(" "),t("div",{staticClass:"col-12 col-sm-6"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:""}},[e._v(e._s(e.trans("finance.payment_method")))]),e._v(" "),t("v-select",{attrs:{label:"name",name:"payment_method_id",id:"payment_method_id",options:e.payment_methods,placeholder:e.trans("payment_method.select_payment_method")},on:{select:e.onPaymentMethodSelect,close:function(t){return e.feePaymentForm.errors.clear("payment_method_id")},remove:e.onPaymentMethodRemove},model:{value:e.selected_payment_method,callback:function(t){e.selected_payment_method=t},expression:"selected_payment_method"}},[e.payment_methods.length?e._e():t("div",{staticClass:"multiselect__option",attrs:{slot:"afterList"},slot:"afterList"},[e._v("\n                                                        "+e._s(e.trans("general.no_option_found"))+"\n                                                    ")])]),e._v(" "),t("show-error",{attrs:{"form-name":e.feePaymentForm,"prop-name":"payment_method_id"}})],1)])]:e._e(),e._v(" "),e.getPaymentMethodDetail("instrument_number")?t("div",{staticClass:"col-12 col-sm-6"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:""}},[e._v(e._s(e.trans("finance.instrument_number")))]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.feePaymentForm.instrument_number,expression:"feePaymentForm.instrument_number"}],staticClass:"form-control",attrs:{type:"text",name:"instrument_number",placeholder:e.trans("finance.instrument_number")},domProps:{value:e.feePaymentForm.instrument_number},on:{input:function(t){t.target.composing||e.$set(e.feePaymentForm,"instrument_number",t.target.value)}}}),e._v(" "),t("show-error",{attrs:{"form-name":e.feePaymentForm,"prop-name":"instrument_number"}})],1)]):e._e(),e._v(" "),e.getPaymentMethodDetail("instrument_date")?t("div",{staticClass:"col-12 col-sm-6"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:""}},[e._v(e._s(e.trans("finance.instrument_date")))]),e._v(" "),t("datepicker",{attrs:{bootstrapStyling:!0,placeholder:e.trans("finance.instrument_date")},on:{selected:function(t){return e.feePaymentForm.errors.clear("instrument_date")}},model:{value:e.feePaymentForm.instrument_date,callback:function(t){e.$set(e.feePaymentForm,"instrument_date",t)},expression:"feePaymentForm.instrument_date"}}),e._v(" "),t("show-error",{attrs:{"form-name":e.feePaymentForm,"prop-name":"instrument_date"}})],1)]):e._e(),e._v(" "),e.getPaymentMethodDetail("instrument_bank_detail")?t("div",{staticClass:"col-12 col-sm-6"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:""}},[e._v(e._s(e.trans("finance.instrument_bank_detail")))]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.feePaymentForm.instrument_bank_detail,expression:"feePaymentForm.instrument_bank_detail"}],staticClass:"form-control",attrs:{type:"text",name:"instrument_bank_detail",placeholder:e.trans("finance.instrument_bank_detail")},domProps:{value:e.feePaymentForm.instrument_bank_detail},on:{input:function(t){t.target.composing||e.$set(e.feePaymentForm,"instrument_bank_detail",t.target.value)}}}),e._v(" "),t("show-error",{attrs:{"form-name":e.feePaymentForm,"prop-name":"instrument_bank_detail"}})],1)]):e._e(),e._v(" "),e.getPaymentMethodDetail("instrument_clearing_date")?t("div",{staticClass:"col-12 col-sm-6"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:""}},[e._v(e._s(e.trans("finance.instrument_clearing_date")))]),e._v(" "),t("datepicker",{attrs:{bootstrapStyling:!0,placeholder:e.trans("finance.instrument_clearing_date")},on:{selected:function(t){return e.feePaymentForm.errors.clear("instrument_clearing_date")}},model:{value:e.feePaymentForm.instrument_clearing_date,callback:function(t){e.$set(e.feePaymentForm,"instrument_clearing_date",t)},expression:"feePaymentForm.instrument_clearing_date"}}),e._v(" "),t("show-error",{attrs:{"form-name":e.feePaymentForm,"prop-name":"instrument_clearing_date"}})],1)]):e._e(),e._v(" "),e.getPaymentMethodDetail("reference_number")?t("div",{staticClass:"col-12 col-sm-6"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:""}},[e._v(e._s(e.trans("finance.reference_number")))]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.feePaymentForm.reference_number,expression:"feePaymentForm.reference_number"}],staticClass:"form-control",attrs:{type:"text",name:"reference_number",placeholder:e.trans("finance.reference_number")},domProps:{value:e.feePaymentForm.reference_number},on:{input:function(t){t.target.composing||e.$set(e.feePaymentForm,"reference_number",t.target.value)}}}),e._v(" "),t("show-error",{attrs:{"form-name":e.feePaymentForm,"prop-name":"reference_number"}})],1)]):e._e(),e._v(" "),t("div",{staticClass:"col-12 col-sm-12"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:""}},[e._v(e._s(e.trans("finance.fee_payment_remarks")))]),e._v(" "),t("autosize-textarea",{attrs:{rows:"2",name:"remarks",placeholder:e.trans("finance.fee_payment_remarks")},model:{value:e.feePaymentForm.remarks,callback:function(t){e.$set(e.feePaymentForm,"remarks",t)},expression:"feePaymentForm.remarks"}}),e._v(" "),t("show-error",{attrs:{"form-name":e.feePaymentForm,"prop-name":"remarks"}})],1)])],2),e._v(" "),t("button",{staticClass:"btn btn-info waves-effect waves-light pull-right",attrs:{type:"submit"}},[e._v(e._s(e.trans("general.save")))])])]),e._v(" "),t("div",{staticClass:"clearfix"})]}))],2)])])])])}),[],!1,null,null,null).exports;const o={components:{},props:["id","uuid","feePayment"],data:function(){return{default_currency:helper.getConfig("default_currency"),payment_gateway:"",razorpay_loaded:0,stripe_loaded:0,total:0,stripe:{card_number:"",month:"",year:"",cvc:""},stripeButton:!0,paypalButton:!0,feePaymentForm:new Form({amount:0,installment_id:"",date:"",installments:[]})}},mounted:function(){this.loadFeePayment(this.feePayment),"INR"!=this.default_currency.name&&helper.getConfig("mode")||!this.getConfig("razorpay")||this.injectRazorpay()},methods:{getConfig:function(e){return helper.getConfig(e)},loadFeePayment:function(e){var t=this;this.feePaymentForm.amount=e.amount,this.feePaymentForm.installment_id=e.fee_payment_installment_id,this.feePaymentForm.date=e.date,this.feePaymentForm.installments=[],this.total=0,e.installments.forEach((function(e){t.feePaymentForm.installments.push({fee_installment_id:e.fee_installment_id,title:e.title,installment_balance:e.installment_balance,late_fee_balance:e.late_fee_balance})}))},getInstallmentTotal:function(e){return e.installment_balance+parseInt(e.late_fee_balance)},formatCurrency:function(e){return helper.formatCurrency(e)},setPaymentGateway:function(e){this.payment_gateway=e},stripeCheckout:function(){var e=this.$loading.show();this.stripeButton=!1,Stripe.setPublishableKey(this.getConfig("stripe_publishable_key")),Stripe.card.createToken({number:this.stripe.card_number,cvc:this.stripe.cvc,exp_month:this.stripe.month,exp_year:this.stripe.year},this.stripeResponseHandler),e.hide()},stripeResponseHandler:function(e,t){var n=this;if(200==e){var a=this.$loading.show();axios.post("/api/student/"+this.uuid+"/payment/"+this.id+"/stripe",{stripeToken:t.id,amount:100*this.total,fee:this.feePaymentForm.amount,handling_fee:this.handlingFee,fee_installment_id:this.feePaymentForm.installment_id,installments:this.feePaymentForm.installments}).then((function(e){a.hide(),toastr.success(e.message),n.$emit("completed"),n.stripeButton=!0})).catch((function(e){a.hide(),helper.showErrorMsg(e),n.stripeButton=!0}))}else toastr.error(t.error.message),this.stripeButton=!0},injectRazorpay:function(){var e=this,t=$.Deferred(),n=document.createElement("script");return n.async="async",n.type="text/javascript",n.src="https://checkout.razorpay.com/v1/checkout.js",n.onload=n.onreadystatechange=function(a,r){n.readyState&&!/loaded|complete/.test(n.readyState)||(r?t.reject():t.resolve()),e.razorpay_loaded=1},n.onerror=function(){t.reject()},document.head.appendChild(n),t.promise()},callRazorpay:function(){var e=this,t={key:this.getConfig("razorpay_key"),protocol:"https",hostname:"api.razorpay.com",amount:100*this.total,name:helper.getConfig("institute_name"),description:i18n.finance.fee_payment,image:this.getLogo,prefill:{email:"",contact:"",name:""},notes:{student_record_id:this.id,fee:this.feePaymentForm.amount,handling_fee:this.handlingFee},handler:function(t,n){e.completeRazorpay(t.razorpay_payment_id)}};window.rzpay=new Razorpay(t),rzpay.open()},completeRazorpay:function(e){var t=this,n=this.$loading.show();axios.post("/api/student/"+this.uuid+"/payment/"+this.id+"/rzp",{transaction_id:e,installments:this.feePaymentForm.installments,fee_installment_id:this.feePaymentForm.installment_id}).then((function(e){n.hide(),toastr.success(e.message),t.$emit("completed")})).catch((function(e){n.hide(),helper.showErrorMsg(e)}))},callBillDesk:function(){var e=this.$loading.show();axios.post("student/"+this.uuid+"/payment/"+this.id+"/billdesk",{amount:this.feePaymentForm.amount,installment_id:this.feePaymentForm.installment_id,installments:this.feePaymentForm.installments}).then((function(t){e.hide(),bdPayment.initialize({msg:t.msg,callbackUrl:t.url,options:{enableChildWindowPosting:!0,enablePaymentRetry:!0,retry_attempt_count:3}})})).catch((function(t){e.hide(),helper.showErrorMsg(t)}))},callPaypal:function(){var e=this;this.paypalButton=!1;var t=this.$loading.show();axios.post("/api/student/"+this.uuid+"/payment/"+this.id+"/paypal",{amount:this.total,fee:this.feePaymentForm.amount,handling_fee:this.handlingFee,fee_installment_id:this.feePaymentForm.installment_id,installments:this.feePaymentForm.installments}).then((function(e){t.hide(),window.location=e})).catch((function(n){t.hide(),e.paypalButton=!0,helper.showErrorMsg(n)}))},payWithPaystack:function(){if("NGN"==helper.getConfig("default_currency").name||"GHS"==helper.getConfig("default_currency").name){var e=this;PaystackPop.setup({key:this.getConfig("paystack_public_key"),email:helper.getAuthUser("email"),amount:100*this.total,currency:helper.getConfig("default_currency").name,ref:""+Math.floor(1e9*Math.random()+1),metadata:{custom_fields:[{display_name:"Student ID",variable_name:"student_record_id",value:this.id},{display_name:"Amount",variable_name:"fee",value:this.feePaymentForm.amount},{display_name:"Handling Fee",variable_name:"handling_fee",value:this.handlingFee}]},callback:function(t){e.completePaystack(t.reference)},onClose:function(){}}).openIframe()}else toastr.error(i18n.configuration.currency_not_supported)},completePaystack:function(e){var t=this,n=this.$loading.show();axios.post("/api/student/"+this.uuid+"/payment/"+this.id+"/paystack",{transaction_id:e,installments:this.feePaymentForm.installments,fee_installment_id:this.feePaymentForm.installment_id}).then((function(e){n.hide(),toastr.success(e.message),t.$emit("completed")})).catch((function(e){n.hide(),helper.showErrorMsg(e)}))}},computed:{getLogo:function(){return helper.getLogo()},handlingFee:function(){var e=0;if(!this.payment_gateway)return e;if(!helper.getConfig(this.payment_gateway+"_charge_handling_fee"))return e;if(helper.getConfig(this.payment_gateway+"_fixed_handling_fee"))e=helper.getConfig(this.payment_gateway+"_handling_fee");else{var t=helper.getConfig(this.payment_gateway+"_handling_fee");e=this.feePaymentForm.amount*(t/100)}return helper.formatNumber(e)},handlingFeeAmount:function(){if(helper.getConfig(this.payment_gateway+"_charge_handling_fee"))return i18n.finance.handling_fee+" "+helper.formatCurrency(this.handlingFee)},totalAmount:function(){return i18n.finance.payable_amount+" "+helper.formatCurrency(this.total)},getGrandTotal:function(){var e=0;return Array.isArray(this.feePaymentForm.installments)?(this.feePaymentForm.installments.forEach((function(t){e+=t.installment_balance+parseInt(t.late_fee_balance)})),e=e?e+this.handlingFee:e,this.total=e,e):e}},filters:{moment:function(e){return helper.formatDate(e)},momentDateTime:function(e){return helper.formatDateTime(e)}}},l=o;var d=n(93379),_=n.n(d),c=n(72371),m={insert:"head",singleton:!1};_()(c.Z,m);c.Z.locals;const u=(0,s.Z)(l,(function(){var e=this,t=e._self._c;return t("transition",{attrs:{name:"modal"}},[t("div",{staticClass:"modal-mask"},[t("div",{staticClass:"modal-wrapper"},[t("div",{staticClass:"modal-container modal-lg"},[t("div",{staticClass:"modal-header"},[e._t("header",(function(){return[e._v("\n                        "+e._s(e.trans("finance.fee_payment"))+"\n                        "),t("span",{staticClass:"float-right pointer",on:{click:function(t){return e.$emit("closeFeePaymentForm")}}},[e._v("x")])]}))],2),e._v(" "),t("div",{staticClass:"modal-body"},[e._t("body",(function(){return[t("h4",[e._v(e._s(e.feePayment.fee_group_name)+" "),t("span",{staticClass:"pull-right"},[e._v(e._s(e._f("moment")(e.feePayment.date)))])]),e._v(" "),t("div",{staticStyle:{"max-height":"600px"}},[t("form",{on:{submit:function(t){return t.preventDefault(),e.submit.apply(null,arguments)},keydown:function(t){return e.feePaymentForm.errors.clear(t.target.name)}}},[t("div",{staticClass:"table-responsive p-2"},[t("table",{staticClass:"table table-bordered"},[t("thead",[t("tr",[t("th",[e._v(e._s(e.trans("finance.fee_installment")))]),e._v(" "),t("th",{staticClass:"text-right"},[e._v(e._s(e.trans("finance.installment_total")))]),e._v(" "),t("th",{staticClass:"text-right"},[e._v(e._s(e.trans("finance.late_fee")))]),e._v(" "),t("th",{staticClass:"text-right"},[e._v(e._s(e.trans("general.total")))])])]),e._v(" "),t("tbody",e._l(e.feePaymentForm.installments,(function(n){return t("tr",[t("td",{domProps:{textContent:e._s(n.title)}}),e._v(" "),t("td",{staticClass:"text-right",domProps:{textContent:e._s(n.installment_balance)}}),e._v(" "),t("td",{staticClass:"text-right"},[e._v("\n                                                    "+e._s(n.late_fee_balance)+"\n                                                ")]),e._v(" "),t("td",{staticClass:"text-right",domProps:{textContent:e._s(e.getInstallmentTotal(n))}})])})),0),e._v(" "),t("tfoot",[t("tr",[t("th",[e._v(e._s(e.trans("general.total")))]),e._v(" "),t("th",{attrs:{colspan:"2"}}),e._v(" "),t("th",{staticClass:"text-right"},[e._v(e._s(e.formatCurrency(e.getGrandTotal)))])])])])]),e._v(" "),t("div",[t("h4",{staticClass:"card-title"},[e._v(e._s(e.trans("finance.choose_payment_gateway")))]),e._v(" "),e.getConfig("razorpay")&&e.razorpay_loaded?t("div",{staticClass:"radio radio-success"},[t("input",{attrs:{type:"radio",name:"payment_gateway",id:"razorpay",value:"razorpay"},on:{change:function(t){return e.setPaymentGateway("razorpay")}}}),e._v(" "),t("label",{attrs:{for:"razorpay"}},[e._v(" \n                                            Razorpay \n                                        ")])]):e._e(),e._v(" "),e.getConfig("billdesk")?t("div",{staticClass:"radio radio-success"},[t("input",{attrs:{type:"radio",name:"payment_gateway",id:"billdesk",value:"billdesk"},on:{change:function(t){return e.setPaymentGateway("billdesk")}}}),e._v(" "),t("label",{attrs:{for:"billdesk"}},[e._v(" Billdesk ")])]):e._e(),e._v(" "),e.getConfig("stripe")?t("div",{staticClass:"radio radio-success"},[t("input",{attrs:{type:"radio",name:"payment_gateway",id:"stripe",value:"stripe"},on:{change:function(t){return e.setPaymentGateway("stripe")}}}),e._v(" "),t("label",{attrs:{for:"stripe"}},[e._v(" Stripe ")])]):e._e(),e._v(" "),e.getConfig("paystack")?t("div",{staticClass:"radio radio-success"},[t("input",{attrs:{type:"radio",name:"payment_gateway",id:"paystack",value:"paystack"},on:{change:function(t){return e.setPaymentGateway("paystack")}}}),e._v(" "),t("label",{attrs:{for:"paystack"}},[e._v(" Paystack ")])]):e._e(),e._v(" "),e.getConfig("paypal")?t("div",{staticClass:"radio radio-success"},[t("input",{attrs:{type:"radio",name:"payment_gateway",id:"paypal",value:"paypal"},on:{change:function(t){return e.setPaymentGateway("paypal")}}}),e._v(" "),t("label",{attrs:{for:"paypal"}},[e._v(" Paypal ")])]):e._e(),e._v(" "),t("p",[e._v(e._s(e.handlingFeeAmount))]),e._v(" "),t("p",[e._v(e._s(e.totalAmount))]),e._v(" "),"billdesk"==e.payment_gateway?[t("button",{staticClass:"btn btn-info",attrs:{type:"button"},on:{click:e.callBillDesk}},[e._v(e._s(e.trans("general.proceed")))])]:e._e(),e._v(" "),"razorpay"==e.payment_gateway?[t("button",{staticClass:"btn btn-info",attrs:{type:"button"},on:{click:e.callRazorpay}},[e._v(e._s(e.trans("general.proceed")))])]:e._e(),e._v(" "),"paystack"==e.payment_gateway?[t("button",{staticClass:"btn btn-info",attrs:{type:"button"},on:{click:e.payWithPaystack}},[e._v(e._s(e.trans("general.proceed")))])]:e._e(),e._v(" "),"paypal"==e.payment_gateway?[e.paypalButton?t("button",{staticClass:"btn btn-info",attrs:{type:"button"},on:{click:e.callPaypal}},[e._v(e._s(e.trans("general.proceed")))]):e._e()]:e._e(),e._v(" "),"stripe"==e.payment_gateway?[t("div",{staticClass:"row m-t-40"},[t("div",{staticClass:"col-12"},[t("div",{staticClass:"form-group"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.stripe.card_number,expression:"stripe.card_number"}],staticClass:"form-control",attrs:{type:"number",maxlength:"16",value:"",placeholder:e.trans("finance.card_number")},domProps:{value:e.stripe.card_number},on:{input:function(t){t.target.composing||e.$set(e.stripe,"card_number",t.target.value)}}})])]),e._v(" "),t("div",{staticClass:"col-3"},[t("div",{staticClass:"form-group"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.stripe.month,expression:"stripe.month"}],staticClass:"form-control",attrs:{type:"number",value:"",placeholder:e.trans("finance.card_expiry_month")},domProps:{value:e.stripe.month},on:{input:function(t){t.target.composing||e.$set(e.stripe,"month",t.target.value)}}})])]),e._v(" "),t("div",{staticClass:"col-4"},[t("div",{staticClass:"form-group"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.stripe.year,expression:"stripe.year"}],staticClass:"form-control",attrs:{type:"number",value:"",placeholder:e.trans("finance.card_expiry_year")},domProps:{value:e.stripe.year},on:{input:function(t){t.target.composing||e.$set(e.stripe,"year",t.target.value)}}})])]),e._v(" "),t("div",{staticClass:"col-1"}),e._v(" "),t("div",{staticClass:"col-4"},[t("div",{staticClass:"form-group"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.stripe.cvc,expression:"stripe.cvc"}],staticClass:"form-control",attrs:{type:"number",value:"",placeholder:e.trans("finance.card_cvc")},domProps:{value:e.stripe.cvc},on:{input:function(t){t.target.composing||e.$set(e.stripe,"cvc",t.target.value)}}})])])]),e._v(" "),e.stripeButton?t("button",{staticClass:"btn btn-info waves-effect waves-light pull-right",attrs:{type:"button"},on:{click:e.stripeCheckout}},[t("span",[e._v(e._s(e.trans("general.proceed")))])]):e._e()]:e._e()],2)])])]}))],2)])])])])}),[],!1,null,null,null).exports;const f={components:{},props:["id","uuid","rid"],data:function(){return{transactions:[],transaction:{},cancel_fee_payment:!1,cancelPaymentForm:new Form({cancellation_remarks:""})}},mounted:function(){this.getDetail(this.id)},methods:{hasPermission:function(e){return helper.hasPermission(e)},formatCurrency:function(e){return helper.formatCurrency(e)},getDetail:function(e){var t=this,n=this.$loading.show();axios.get("/api/student/"+this.uuid+"/fee/"+this.rid+"/"+e).then((function(e){t.transactions=e.transactions,t.transaction=e.transactions[0],n.hide()})).catch((function(e){n.hide(),helper.showErrorMsg(e)}))},getEmployeeName:function(e){return helper.getEmployeeName(e)},cancelPayment:function(){var e=this,t=this.$loading.show();this.cancelPaymentForm.post("/api/student/"+this.uuid+"/fee/"+this.rid+"/"+this.id+"/"+this.transaction.id+"/cancel").then((function(n){toastr.success(n.message),e.$emit("completed"),t.hide()})).catch((function(e){t.hide(),helper.showErrorMsg(e)}))},printReceipt:function(){var e=this.$loading.show();axios.post("/api/student/"+this.uuid+"/fee/"+this.rid+"/"+this.id+"/"+this.transaction.id+"/print").then((function(t){var n=window.open("/print");e.hide(),n.document.write(t)})).catch((function(t){e.hide(),helper.showErrorMsg(t)}))}},computed:{transactionGroup:function(){var e=[];return this.transaction.groups.forEach((function(t){e.push((t.prefix||"")+""+t.number)})),e.sort(),e}},filters:{moment:function(e){return helper.formatDate(e)},momentDateTime:function(e){return helper.formatDateTime(e)}},watch:{id:function(e){e&&this.getDetail(e)}}};const p=(0,s.Z)(f,(function(){var e=this,t=e._self._c;return t("div",[e._l(e.transactions,(function(n){return[t("button",{staticClass:"btn btn-info m-r-10",attrs:{type:"button"},on:{click:function(t){e.transaction=n}}},[e._v(e._s((n.prefix||"")+""+n.number))])]})),e._v(" "),t("button",{directives:[{name:"tooltip",rawName:"v-tooltip",value:e.trans("finance.print_receipt"),expression:"trans('finance.print_receipt')"}],staticClass:"btn btn-info btn-sm pull-right",attrs:{type:"button"},on:{click:e.printReceipt}},[t("i",{staticClass:"fas fa-print"})]),e._v(" "),e.transaction.id?[t("div",{staticClass:"table-responsive m-t-20"},[t("table",{staticClass:"table table-bordered"},[t("tbody",[t("tr",[t("td",[e._v(e._s(e.trans("finance.receipt_no")))]),e._v(" "),t("td",[e._v(e._s((e.transaction.prefix||"")+""+e.transaction.number)+"\n                                "),e.transactionGroup.length>1?t("span",[e._v("("+e._s(e.transactionGroup.toString())+")")]):e._e()]),e._v(" "),e.transaction.is_online_payment?[t("td",[e._v(e._s(e.trans("finance.payment_method")))]),e._v(" "),t("td",[e._v(e._s(e.trans("finance.online_payment")))])]:[t("td",[e._v(e._s(e.trans("finance.account")))]),e._v(" "),t("td",[e._v(e._s(e.transaction.account?e.transaction.account.name:""))])]],2),e._v(" "),t("tr",[t("td",[e._v(e._s(e.trans("finance.amount")))]),e._v(" "),t("td",[e._v(e._s(e.formatCurrency(e.transaction.amount)))]),e._v(" "),t("td",[e._v(e._s(e.trans("finance.date")))]),e._v(" "),t("td",[e._v(e._s(e._f("moment")(e.transaction.date)))])]),e._v(" "),t("tr",[e.transaction.is_online_payment?[t("td",[e._v(e._s(e.trans("finance.reference_number")))]),e._v(" "),t("td",[e._v(e._s(e.transaction.reference_number))])]:[t("td",[e._v(e._s(e.trans("finance.payment_method")))]),e._v(" "),t("td",[e._v("\n                                    "+e._s(e.transaction.payment_method.name)+"\n                                    "),e.transaction.instrument_number?t("span",[t("br"),e._v(e._s(e.trans("finance.instrument_number"))+": "+e._s(e.transaction.instrument_number))]):e._e(),e._v(" "),e.transaction.instrument_date?t("span",[t("br"),e._v(e._s(e.trans("finance.instrument_date"))+": "),t("span",[e._v(e._s(e._f("moment")(e.transaction.instrument_date)))])]):e._e(),e._v(" "),e.transaction.instrument_clearing_date?t("span",[t("br"),e._v(e._s(e.trans("finance.instrument_clearing_date"))+": "),t("span",[e._v(e._s(e._f("moment")(e.transaction.instrument_clearing_date)))])]):e._e(),e._v(" "),e.transaction.instrument_bank_detail?t("span",[t("br"),e._v(e._s(e.trans("finance.instrument_bank_detail"))+": "+e._s(e.transaction.instrument_bank_detail))]):e._e(),e._v(" "),e.transaction.reference_number?t("span",[t("br"),e._v(e._s(e.trans("finance.reference_number"))+": "+e._s(e.transaction.reference_number))]):e._e()])],e._v(" "),t("td",[e._v(e._s(e.trans("finance.date_of_entry")))]),e._v(" "),t("td",[e._v(e._s(e._f("momentDateTime")(e.transaction.created_at)))])],2),e._v(" "),t("tr",[e.transaction.is_online_payment?e._e():[t("td",[e._v(e._s(e.trans("finance.remarks")))]),e._v(" "),t("td",[e._v(e._s(e.transaction.remarks))]),e._v(" "),t("td",[e._v(e._s(e.trans("finance.entry_by")))]),e._v(" "),t("td",[e._v("\n                                    "+e._s(e.getEmployeeName(e.transaction.user.employee))+"\n                                ")])]],2)])])]),e._v(" "),e.transaction.is_deletable&&e.hasPermission("cancel-fee-payment")?t("button",{staticClass:"btn btn-block btn-danger",attrs:{type:"button"},on:{click:function(t){e.cancel_fee_payment=!0}}},[e._v(e._s(e.trans("student.cancel_fee_payment")))]):e._e(),e._v(" "),e.cancel_fee_payment?[e.transaction.is_deletable?t("form",{staticClass:"m-t-20",on:{submit:function(t){return t.preventDefault(),e.cancelPayment.apply(null,arguments)},keydown:function(t){return e.cancelPaymentForm.errors.clear(t.target.name)}}},[t("div",{staticClass:"row"},[t("div",{staticClass:"col-12"},[e.transactionGroup.length>1?t("div",{staticClass:"form-group"},[t("div",[e._v(e._s(e.trans("finance.cancel_all_group_fee_payment",{numbers:e.transactionGroup.toString()})))])]):e._e(),e._v(" "),t("div",{staticClass:"form-group"},[t("autosize-textarea",{attrs:{rows:"2",name:"cancellation_remarks",placeholder:e.trans("student.cancellation_remarks")},model:{value:e.cancelPaymentForm.cancellation_remarks,callback:function(t){e.$set(e.cancelPaymentForm,"cancellation_remarks",t)},expression:"cancelPaymentForm.cancellation_remarks"}}),e._v(" "),t("show-error",{attrs:{"form-name":e.cancelPaymentForm,"prop-name":"cancellation_remarks"}})],1),e._v(" "),t("button",{staticClass:"btn btn-danger waves-effect waves-light",attrs:{type:"submit"}},[e._v(e._s(e.trans("general.save")))])])])]):e._e()]:e._e()]:e._e()],2)}),[],!1,null,null,null).exports,h={components:{studentSummary:a.Z,feePaymentForm:i,feePaymentParentForm:u,feeDetail:p},data:function(){return{uuid:this.$route.params.uuid,record_id:this.$route.params.record_id,student_record:{fee_allocation:{fee_allocation_groups:[]}},feePayment:{fee_group_name:"",fee_payment_installment_id:"",student_fee_record_id:"",date:helper.today(),installments:[],amount:0},fee:{groups:[]},feePaymentForm:!1,feePaymentShow:!1}},mounted:function(){helper.hasPermission("list-student-fee")||(helper.notAccessibleMsg(),this.$router.push("/dashboard")),this.getRecord(),helper.showDemoNotification(["student"])},methods:{hasPermission:function(e){return helper.hasPermission(e)},hasAnyRole:function(e){return helper.hasAnyRole(e)},hasNotAnyRole:function(e){return helper.hasNotAnyRole(e)},getConfig:function(e){return helper.getConfig(e)},getStudentName:function(e){return helper.getStudentName(e)},getRecord:function(){var e=this,t=this.$loading.show();this.feePaymentForm=!1,this.feePaymentShow=!1,axios.get("/api/student/"+this.uuid+"/fee/"+this.record_id).then((function(n){e.student_record=n.student_record,e.student_record.student_fee_records.length||e.$router.push("/student/"+e.uuid),t.hide()})).catch((function(n){t.hide(),helper.showErrorMsg(n),e.hasAnyRole(["student","parent"])?e.$router.push("/student/list"):e.$router.push("/student/"+e.uuid+"/fee/"+e.record_id+"/create")}))},calculate:function(){var e=this;this.fee={groups:[]},this.student_record.fee_allocation.fee_allocation_groups.forEach((function(t){var n=[],a=[],r=[];a.push(i18n.finance.fee_installment_title),a.push(i18n.finance.fee_installment_due_date),t.fee_group.fee_heads.forEach((function(e){a.push(e.name)})),t.fee_group.options.has_transport&&(a.push(i18n.transport.circle),a.push(i18n.transport.fee)),r.push(i18n.finance.total),r.push(""),a.push(i18n.finance.late_fee),a.push(i18n.finance.installment_total),a.push(i18n.finance.other),a.push(i18n.finance.paid),a.push(i18n.finance.balance),a.push(i18n.finance.fee_status),t.fee_installments.forEach((function(a){var r=e.student_record.student_fee_records.find((function(e){return e.fee_installment_id==a.id})),s=[];s.push({text:a.title}),s.push({text:e.showDate(r.due_date||a.due_date)}),t.fee_group.fee_heads.forEach((function(t){s.push({text:e.getInstallmentFeeAmount(a,t.id),actual:e.getInstallmentFeeAmountWithoutConcession(a,t.id),is_concession:!!e.checkInstallmentConcession(a,t.id)})})),t.fee_group.options.has_transport&&(s.push({text:e.getTransportCircleName(a)}),s.push({text:e.getTransportFeeAmount(a)})),s.push({text:e.getLateFeeAmount(a)}),s.push({text:e.getInstallmentTotalAmount(a)}),s.push({text:e.getInstallmentOtherAmount(a)}),s.push({text:e.getInstallmentPaidAmount(a)}),s.push({text:e.getInstallmentBalanceAmount(a)}),s.push({text:e.getInstallmentPrintStatus(a)}),n.push({data:s})})),t.fee_group.fee_heads.forEach((function(n){r.push(e.getTotalFee(t,n.id))})),t.fee_group.options.has_transport&&(r.push(""),r.push(e.getTransportFeeTotal(t))),r.push(e.getLateFeeTotal(t)),r.push(e.getInstallmentGrandTotal(t)),r.push(e.getInstallmentGrandOther(t)),r.push(e.getInstallmentPaidGrandTotal(t)),r.push(e.getInstallmentBalanceGrandTotal(t)),r.push("");var s={name:t.fee_group.name,heads:a,installments:n,foots:r};e.fee.groups.push(s)}))},formatCurrency:function(e){return helper.formatCurrency(e)},isInstallmentOverdue:function(e){var t=this.student_record.student_fee_records.find((function(t){return t.fee_installment_id==e.id}));return helper.today()>(t.due_date||e.due_date)&&"paid"!=t.status?helper.getDateDiff(t.due_date||e.due_date):0},getStatus:function(e){var t=this.student_record.student_fee_records.find((function(t){return t.fee_installment_id==e.id}));return"paid"==t.status?'<span class="label label-success">'+i18n.student.fee_status_paid+"</span>":"partially_paid"==t.status?'<span class="label label-warning">'+i18n.student.fee_status_partially_paid+"</span>":"cancelled"==t.status?'<span class="label label-danger">'+i18n.student.fee_status_cancelled+"</span>":'<span class="label label-danger">'+i18n.student.fee_status_unpaid+"</span>"},getInstallmentDueDate:function(e){var t=this.student_record.student_fee_records.find((function(t){return t.fee_installment_id==e.id}));return helper.formatDate(t.due_date||e.due_date)},getInstallmentStatus:function(e){return this.student_record.student_fee_records.find((function(t){return t.fee_installment_id==e.id})).status},getInstallmentFee:function(e,t){var n=this.getInstallmentFeeWithoutConcession(e,t);return this.getInstallmentFeeWithConcession(n,e,t)},getInstallmentFeeWithoutConcession:function(e,t){var n=e.fee_installment_details.find((function(e){return e.fee_head_id==t}));return void 0===n?0:this.student_record.student_fee_records.find((function(t){return t.fee_installment_id==e.id})).student_optional_fee_records.findIndex((function(e){return e.fee_head_id==t}))<0?n.amount:0},checkInstallmentConcession:function(e,t){e.fee_installment_details.find((function(e){return e.fee_head_id==t}));var n=this.student_record.student_fee_records.find((function(t){return t.fee_installment_id==e.id}));return(n.fee_concession?n.fee_concession.fee_concession_details.findIndex((function(e){return e.fee_head_id==t})):-1)>=0},getInstallmentFeeWithConcession:function(e,t,n){t.fee_installment_details.find((function(e){return e.fee_head_id==n}));var a=this.student_record.student_fee_records.find((function(e){return e.fee_installment_id==t.id})),r=a.fee_concession?a.fee_concession.fee_concession_details.findIndex((function(e){return e.fee_head_id==n})):-1;if(r>=0){var s=a.fee_concession.fee_concession_details[r],i="percent"==s.type?e*(s.amount/100):s.amount;return e-i>=0?Math.ceil(e-i):0}return Math.ceil(e)},getInstallmentFeeAmountWithoutConcession:function(e,t){var n=this.getInstallmentFeeWithoutConcession(e,t);return helper.formatCurrency(n)},getInstallmentFeeAmount:function(e,t){var n=this.getInstallmentFee(e,t);return helper.formatCurrency(n)},getInstallmentTotalWithoutLateFee:function(e){var t=this,n=(this.student_record.student_fee_records.find((function(t){return t.fee_installment_id==e.id})),0);e.fee_installment_details.forEach((function(a){n+=t.getInstallmentFee(e,a.fee_head_id)}));var a=this.getTransportFee(e);return n+=Number.isInteger(a)?a:0},getInstallmentTotal:function(e){var t=this.student_record.student_fee_records.find((function(t){return t.fee_installment_id==e.id})),n=this.getInstallmentTotalWithoutLateFee(e);if(n||"unpaid"!=t.status){var a=this.getLateFee(e);n+=Number.isInteger(a)?a:0}return n},getInstallmentTotalAmount:function(e){var t=this.getInstallmentTotal(e);return helper.formatCurrency(t)},getInstallmentOther:function(e){var t=this.student_record.student_fee_records.find((function(t){return t.fee_installment_id==e.id})),n=0;return t.transactions.forEach((function(e){e.is_cancelled||(e.options.additional_fee_charge&&e.options.additional_fee_charge.amount&&(n+=e.options.additional_fee_charge.amount),e.options.additional_fee_discount&&e.options.additional_fee_discount.amount&&(n-=e.options.additional_fee_discount.amount))})),n},getInstallmentOtherAmount:function(e){var t=this.getInstallmentOther(e);return helper.formatCurrency(t)},getInstallmentPaid:function(e){var t=this.student_record.student_fee_records.find((function(t){return t.fee_installment_id==e.id})),n=0;return t.transactions.forEach((function(e){e.is_cancelled||(n+=e.amount)})),n},getInstallmentPaidAmount:function(e){var t=this.getInstallmentPaid(e);return helper.formatCurrency(t)},getInstallmentBalance:function(e){return this.getInstallmentTotal(e)+this.getInstallmentOther(e)-this.getInstallmentPaid(e)},getInstallmentBalanceAmount:function(e){var t=this.getInstallmentBalance(e);return helper.formatCurrency(t)},getTransportCircleName:function(e){var t=this.student_record.student_fee_records.find((function(t){return t.fee_installment_id==e.id}));return t.transport_circle?t.transport_circle.name:"-"},getTransportFee:function(e){var t=this.student_record.student_fee_records.find((function(t){return t.fee_installment_id==e.id}));return t.transport_circle_id&&e.transport_fee_id?e.transport_fee.transport_fee_details.find((function(e){return e.transport_circle_id==t.transport_circle_id})).amount:"-"},getTransportFeeAmount:function(e){var t=this.getTransportFee(e);return Number.isInteger(t)?helper.formatCurrency(t):"-"},getLateFeeAmount:function(e){var t=this.getLateFee(e);return Number.isInteger(t)?helper.formatCurrency(t):"-"},getLateFee:function(e){if(!this.getInstallmentTotalWithoutLateFee(e))return"-";var t=helper.toDate(this.feePayment.date),n=this.student_record.student_fee_records.find((function(t){return t.fee_installment_id==e.id}));if("paid"==n.status)return n.late_fee_charged;if(null==n.late_fee_applicable&&!e.late_fee_applicable||0==n.late_fee_applicable)return"-";if(t<=(n.due_date||e.due_date))return"-";var a=helper.getDateDiff(n.due_date||e.due_date,t),r=Math.floor(a/(n.late_fee_frequency||e.late_fee_frequency));return(n.late_fee||e.late_fee)*r},showInstallmentDetail:function(e,t){var n=this;this.feePayment.installments=[],this.feePayment.fee_group_name=e.fee_group.name;var a=e.fee_installments.filter((function(e){return e.due_date<=t.due_date})),r=0;a.forEach((function(e){var t=n.student_record.student_fee_records.find((function(t){return t.fee_installment_id==e.id}));if("unpaid"==t.status||"partially_paid"==t.status){var a=n.getInstallmentTotalWithoutLateFee(e),s=n.getInstallmentOther(e),i=n.getLateFee(e),o=n.getInstallmentPaid(e),l=(a+=s)>o?a-o:0;a&&(i=Number.isInteger(i)?i:0);var d=!l&&i?i-(o-a):i,_=a;a&&(_+=i=Number.isInteger(i)?i:0);var c=_-o;r+=c,n.feePayment.installments.push({fee_installment_id:t.fee_installment_id,title:e.title,installment_fee:a,installment_balance:l,late_fee_balance:Number.isInteger(d)?d:0,late_fee:i,paid:o,total:c})}})),this.feePayment.amount=r,this.feePayment.fee_payment_installment_id=t.id,this.feePaymentForm=!0},getTotalFee:function(e,t){var n=this,a=0;return e.fee_installments.forEach((function(e){a+=n.getInstallmentFee(e,t)})),helper.formatCurrency(a)},getTransportFeeTotal:function(e){var t=this,n=0;return e.fee_installments.forEach((function(e){var a=t.getTransportFee(e);n+=Number.isInteger(a)?a:0})),n?this.formatCurrency(n):"-"},getLateFeeTotal:function(e){var t=this,n=0;return e.fee_installments.forEach((function(e){var a=t.getLateFee(e);n+=Number.isInteger(a)?a:0})),n?this.formatCurrency(n):"-"},getInstallmentGrandTotal:function(e){var t=this.getInstallmentGrandTotalAmount(e);return Number.isInteger(t)?helper.formatCurrency(t):"-"},getInstallmentGrandTotalAmount:function(e){var t=this,n=0;return e.fee_installments.forEach((function(e){n+=t.getInstallmentTotal(e)})),n},getInstallmentGrandOther:function(e){var t=this.getInstallmentGrandOtherAmount(e);return Number.isInteger(t)?helper.formatCurrency(t):"-"},getInstallmentGrandOtherAmount:function(e){var t=this,n=0;return e.fee_installments.forEach((function(e){n+=t.getInstallmentOther(e)})),n},getInstallmentPaidGrandTotal:function(e){var t=this.getInstallmentPaidGrandTotalAmount(e);return Number.isInteger(t)?helper.formatCurrency(t):"-"},getInstallmentPaidGrandTotalAmount:function(e){var t=this,n=0;return e.fee_installments.forEach((function(e){n+=t.getInstallmentPaid(e)})),n},getInstallmentBalanceGrandTotal:function(e){var t=this.getInstallmentBalanceGrandTotalAmount(e);return Number.isInteger(t)?helper.formatCurrency(t):"-"},getInstallmentBalanceGrandTotalAmount:function(e){var t=this,n=0;return e.fee_installments.forEach((function(e){n+=t.getInstallmentBalance(e)})),n},paymentMade:function(){this.getRecord()},showDate:function(e){return helper.formatDate(e)},getInstallmentPrintStatus:function(e){var t=this.student_record.student_fee_records.find((function(t){return t.fee_installment_id==e.id}));return"paid"==t.status?i18n.student.fee_status_paid:"partially_paid"==t.status?i18n.student.fee_status_partially_paid:"cancelled"==t.status?i18n.student.fee_status_cancelled:"unpaid"==t.status?i18n.student.fee_status_unpaid:void 0},setTransaction:function(e){var t=this.student_record.student_fee_records.find((function(t){return t.fee_installment_id==e.id}));this.student_fee_record_id=t.id,this.feePaymentShow=!0},print:function(){var e=this.$loading.show();this.calculate(),axios.post("/api/student/"+this.uuid+"/fee/"+this.record_id+"/print",{fee:this.fee}).then((function(t){var n=window.open("/print");e.hide(),n.document.write(t)})).catch((function(t){e.hide(),helper.showErrorMsg(t)}))},pdf:function(){var e=this,t=this.$loading.show();this.calculate(),axios.post("/api/student/"+this.uuid+"/fee/"+this.record_id+"/pdf",{fee:this.fee}).then((function(n){t.hide(),window.open("/download/report/"+n+"?token="+e.authToken)})).catch((function(e){t.hide(),helper.showErrorMsg(e)}))},confirmEmptyReceiptDelete:function(e){var t=this;return function(n){return t.deleteEmptyReceipt(e)}},deleteEmptyReceipt:function(e){var t=this,n=this.$loading.show(),a=this.student_record.student_fee_records.find((function(t){return t.fee_installment_id==e.id}));axios.post("/api/student/"+this.uuid+"/fee/"+this.record_id+"/"+a.id+"/cancel").then((function(e){toastr.success(e.message),t.getRecord(),n.hide()})).catch((function(e){n.hide(),helper.showErrorMsg(e)}))},confirmResetFee:function(e){var t=this;return function(n){return t.resetFee(e)}},resetFee:function(e){var t=this,n=this.$loading.show();axios.patch("/api/student/"+this.uuid+"/fee/"+this.record_id+"/reset").then((function(e){toastr.success(e.message),t.getRecord(),n.hide()})).catch((function(e){n.hide(),helper.showErrorMsg(e)}))}},filters:{moment:function(e){return helper.formatDate(e)},momentDateTime:function(e){return helper.formatDateTime(e)}},computed:{authToken:function(){return helper.getAuthToken()},resetFeeOption:function(){return!!this.student_record.id&&this.student_record.student_fee_records.every((function(e){return"unpaid"==e.status}))},finalTotal:function(){var e=this,t=0;return this.student_record.fee_allocation.fee_allocation_groups.forEach((function(n){t+=e.getInstallmentGrandTotalAmount(n)})),helper.formatCurrency(t)},finalOther:function(){var e=this,t=0;return this.student_record.fee_allocation.fee_allocation_groups.forEach((function(n){t+=e.getInstallmentGrandOtherAmount(n)})),helper.formatCurrency(t)},finalPaid:function(){var e=this,t=0;return this.student_record.fee_allocation.fee_allocation_groups.forEach((function(n){t+=e.getInstallmentPaidGrandTotalAmount(n)})),helper.formatCurrency(t)},finalBalance:function(){var e=this,t=0;return this.student_record.fee_allocation.fee_allocation_groups.forEach((function(n){t+=e.getInstallmentBalanceGrandTotalAmount(n)})),helper.formatCurrency(t)}},watch:{"$route.params.uuid":function(e){this.uuid=e,this.record_id=this.$route.params.record_id,this.getRecord()}}},g=h;var v=n(43098),y={insert:"head",singleton:!1};_()(v.Z,y);v.Z.locals;const b=(0,s.Z)(g,(function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"page-titles"},[t("div",{staticClass:"row"},[t("div",{staticClass:"col-12 col-sm-6"},[t("h3",{staticClass:"text-themecolor"},[e._v(e._s(e.trans("finance.fee_detail"))+" "),e.student_record.student?t("small",[e._v(e._s(e.getStudentName(e.student_record.student))+"  ("+e._s(e.student_record.academic_session.name)+")")]):e._e()])]),e._v(" "),t("div",{staticClass:"col-12 col-sm-6"},[t("div",{staticClass:"action-buttons pull-right"},[t("router-link",{staticClass:"btn btn-info btn-sm",attrs:{to:"/student/list"}},[t("i",{staticClass:"fas fa-list"}),e._v(" "),t("span",{staticClass:"d-none d-sm-inline"},[e._v(e._s(e.trans("student.student")))])]),e._v(" "),t("div",{staticClass:"btn-group"},[t("button",{directives:[{name:"tooltip",rawName:"v-tooltip",value:e.trans("general.more_option"),expression:"trans('general.more_option')"}],staticClass:"btn btn-info btn-sm dropdown-toggle no-caret",attrs:{type:"button",role:"menu",id:"moreOption","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"}},[t("i",{staticClass:"fas fa-ellipsis-h"}),e._v(" "),t("span",{staticClass:"d-none d-sm-inline"})]),e._v(" "),t("div",{class:["dropdown-menu","ltr"==e.getConfig("direction")?"dropdown-menu-right":""],attrs:{"aria-labelledby":"moreOption"}},[t("button",{staticClass:"dropdown-item custom-dropdown",on:{click:function(t){return e.$router.push("/student/"+e.student_record.student.uuid)}}},[t("i",{staticClass:"fas fa-arrow-circle-right"}),e._v(" "+e._s(e.trans("student.view_detail")))]),e._v(" "),e.hasPermission("set-fee")?t("button",{staticClass:"dropdown-item custom-dropdown",on:{click:function(t){return e.$router.push("/student/"+e.student_record.student.uuid+"/fee/"+e.student_record.id+"/set")}}},[t("i",{staticClass:"fas fa-file"}),e._v(" "+e._s(e.trans("student.set_fee")))]):e._e(),e._v(" "),t("button",{staticClass:"dropdown-item custom-dropdown",on:{click:e.print}},[t("i",{staticClass:"fas fa-print"}),e._v(" "+e._s(e.trans("general.print")))]),e._v(" "),t("button",{staticClass:"dropdown-item custom-dropdown",on:{click:e.pdf}},[t("i",{staticClass:"fas fa-file-pdf"}),e._v(" "+e._s(e.trans("general.generate_pdf")))])])])],1)])])]),e._v(" "),t("div",{staticClass:"container-fluid"},[t("div",{staticClass:"row"},[t("div",{staticClass:"col-12"},[t("div",{staticClass:"card"},[t("div",{staticClass:"card-body py-4"},[t("student-summary",{staticClass:"border-bottom",attrs:{"student-record":e.student_record}})],1),e._v(" "),t("div",{staticClass:"card-body"},[e.hasPermission("customize-fee-date")?t("div",{staticClass:"row justify-content-end px-4"},[t("div",{staticClass:"col-12 col-sm-3"},[t("div",{staticClass:"form-group"},[t("datepicker",{attrs:{bootstrapStyling:!0,placeholder:e.trans("student.date_of_payment")},model:{value:e.feePayment.date,callback:function(t){e.$set(e.feePayment,"date",t)},expression:"feePayment.date"}})],1)])]):e._e(),e._v(" "),e._l(e.student_record.fee_allocation.fee_allocation_groups,(function(n){return[t("h4",{staticClass:"card-title m-l-20"},[e._v(e._s(n.fee_group.name))]),e._v(" "),t("div",{staticClass:"table-responsive p-3"},[t("table",{staticClass:"table table-sm"},[t("thead",[t("tr",[t("th",[e._v(e._s(e.trans("finance.fee_installment_title")))]),e._v(" "),t("th",[e._v(e._s(e.trans("finance.fee_installment_due_date")))]),e._v(" "),e._l(n.fee_group.fee_heads,(function(n){return t("th",{domProps:{textContent:e._s(n.name)}})})),e._v(" "),t("th",[n.fee_group.options.has_transport?t("span",[e._v(e._s(e.trans("transport.circle")))]):e._e()]),e._v(" "),t("th",[n.fee_group.options.has_transport?t("span",[e._v(e._s(e.trans("transport.fee")))]):e._e()]),e._v(" "),t("th",[e._v(e._s(e.trans("finance.late_fee")))]),e._v(" "),t("th",[e._v(e._s(e.trans("finance.installment_total")))]),e._v(" "),t("th",[e._v(e._s(e.trans("finance.other")))]),e._v(" "),t("th",[e._v(e._s(e.trans("finance.paid")))]),e._v(" "),t("th",[e._v(e._s(e.trans("finance.balance")))]),e._v(" "),e.hasPermission("make-fee-payment")?t("th",[e._v(e._s(e.trans("finance.pay_fee")))]):t("th",[e._v(e._s(e.trans("finance.fee_status")))])],2)]),e._v(" "),t("tbody",[e._l(n.fee_installments,(function(a){return t("tr",[t("td",[e._v(e._s(a.title))]),e._v(" "),t("td",[e._v(e._s(e.getInstallmentDueDate(a))+"\n                                                "),e.isInstallmentOverdue(a)?[t("br"),e._v(" "),t("span",{staticClass:"label label-danger"},[e._v(e._s(e.trans("finance.fee_overdue_day",{day:e.isInstallmentOverdue(a)})))])]:e._e()],2),e._v(" "),e._l(n.fee_group.fee_heads,(function(n){return t("td",[e.checkInstallmentConcession(a,n.id)?t("span",{staticStyle:{"text-decoration":"line-through"}},[e._v(e._s(e.getInstallmentFeeAmountWithoutConcession(a,n.id)))]):e._e(),e._v("\n                                                "+e._s(e.getInstallmentFeeAmount(a,n.id))+"\n                                            ")])})),e._v(" "),t("td",[n.fee_group.options.has_transport?t("span",[e._v(e._s(e.getTransportCircleName(a)))]):e._e()]),e._v(" "),t("td",[n.fee_group.options.has_transport?t("span",[e._v(e._s(e.getTransportFeeAmount(a)))]):e._e()]),e._v(" "),t("td",[e._v(e._s(e.getLateFeeAmount(a)))]),e._v(" "),t("td",[e._v(e._s(e.getInstallmentTotalAmount(a)))]),e._v(" "),t("td",[e._v(e._s(e.getInstallmentOtherAmount(a)))]),e._v(" "),t("td",[e._v(e._s(e.getInstallmentPaidAmount(a)))]),e._v(" "),t("td",[e._v(e._s(e.getInstallmentBalanceAmount(a)))]),e._v(" "),e.hasPermission("make-fee-payment")?t("td",["unpaid"==e.getInstallmentStatus(a)?t("span",[t("button",{staticClass:"btn btn-info btn-sm",attrs:{type:"button"},on:{click:function(t){return e.showInstallmentDetail(n,a)}}},[e._v(e._s(e.trans("finance.pay_fee")))])]):"cancelled"==e.getInstallmentStatus(a)?t("span",[t("span",{staticClass:"label label-danger"},[e._v(e._s(e.trans("finance.fee_status_cancelled")))])]):t("span",[t("div",{staticClass:"btn-group"},["paid"==e.getInstallmentStatus(a)?[t("button",{staticClass:"btn btn-sm btn-success"},[e._v(e._s(e.trans("student.fee_status_paid")))]),e._v(" "),e._m(0,!0)]:e._e(),e._v(" "),"partially_paid"==e.getInstallmentStatus(a)?[t("button",{staticClass:"btn btn-sm btn-warning",on:{click:function(t){return e.showInstallmentDetail(n,a)}}},[e._v(e._s(e.trans("student.fee_status_partially_paid")))]),e._v(" "),e._m(1,!0)]:e._e(),e._v(" "),t("div",{staticClass:"dropdown-menu"},[e.getInstallmentPaid(a)?t("button",{staticClass:"dropdown-item custom-dropdown-menu",on:{click:function(t){return t.preventDefault(),e.setTransaction(a)}}},[t("i",{staticClass:"fas fa-arrow-circle-right"}),e._v(" "+e._s(e.trans("finance.receipt_detail"))+"\n                                                            ")]):!e.getInstallmentPaid(a)&&e.hasPermission("cancel-fee-payment")?t("button",{directives:[{name:"confirm",rawName:"v-confirm",value:{ok:e.confirmEmptyReceiptDelete(a)},expression:"{ok: confirmEmptyReceiptDelete(fee_installment)}"}],key:a.id,staticClass:"dropdown-item custom-dropdown-menu"},[t("i",{staticClass:"fas fa-arrow-circle-right"}),e._v(" "+e._s(e.trans("student.cancel_fee_payment"))+"\n                                                            ")]):e._e()])],2)])]):t("td",["unpaid"==e.getInstallmentStatus(a)?t("span",[e._v(e._s(e.trans("student.fee_status_unpaid")))]):t("span",[e._v(e._s(e.trans("student.fee_status_paid")))])])],2)})),e._v(" "),t("tr",[t("th",{attrs:{colspan:"2"}},[e._v(e._s(e.trans("general.total")))]),e._v(" "),e._l(n.fee_group.fee_heads,(function(a){return t("th",[e._v("\n                                                "+e._s(e.getTotalFee(n,a.id))+"\n                                            ")])})),e._v(" "),t("th"),e._v(" "),t("th",[n.fee_group.options.has_transport?t("span",[e._v(e._s(e.getTransportFeeTotal(n)))]):e._e()]),e._v(" "),t("th",[e._v(e._s(e.getLateFeeTotal(n)))]),e._v(" "),t("th",[e._v(e._s(e.getInstallmentGrandTotal(n)))]),e._v(" "),t("th",[e._v(e._s(e.getInstallmentGrandOther(n)))]),e._v(" "),t("th",[e._v(e._s(e.getInstallmentPaidGrandTotal(n)))]),e._v(" "),t("th",[e._v(e._s(e.getInstallmentBalanceGrandTotal(n)))]),e._v(" "),(e.hasPermission("make-fee-payment"),t("th"))],2)],2)])])]})),e._v(" "),t("div",{staticClass:"table-responsive p-3"},[t("table",{staticClass:"table table"},[t("thead",[t("tr",[t("th",[e._v(e._s(e.trans("finance.installment_total")))]),e._v(" "),t("th",[e._v(e._s(e.trans("finance.other")))]),e._v(" "),t("th",[e._v(e._s(e.trans("finance.paid")))]),e._v(" "),t("th",[e._v(e._s(e.trans("finance.balance")))])])]),e._v(" "),t("tbody",[t("tr",[t("td",[e._v(e._s(e.finalTotal))]),e._v(" "),t("td",[e._v(e._s(e.finalOther))]),e._v(" "),t("td",[e._v(e._s(e.finalPaid))]),e._v(" "),t("td",[e._v(e._s(e.finalBalance))])])])])]),e._v(" "),e.resetFeeOption&&e.hasPermission("set-fee")?t("div",{staticClass:"row justify-content-md-center"},[t("div",{staticClass:"col-4"},[t("button",{directives:[{name:"confirm",rawName:"v-confirm",value:{ok:e.confirmResetFee(e.student_record)},expression:"{ok: confirmResetFee(student_record)}"},{name:"tooltip",rawName:"v-tooltip",value:e.trans("student.reset_fee"),expression:"trans('student.reset_fee')"}],key:e.student_record.id,staticClass:"btn btn-danger btn-block"},[e._v(e._s(e.trans("student.reset_fee")))])])]):e._e()],2)])])])]),e._v(" "),e.feePaymentForm&&e.hasNotAnyRole(["parent","student"])&&e.hasPermission("make-fee-payment")?t("fee-payment-form",{attrs:{uuid:e.uuid,id:e.record_id,"fee-payment":e.feePayment},on:{completed:e.paymentMade,closeFeePaymentForm:function(t){e.feePaymentForm=!1}}}):e._e(),e._v(" "),e.feePaymentForm&&e.hasAnyRole(["parent","student"])&&e.hasPermission("make-fee-payment")?t("fee-payment-parent-form",{attrs:{uuid:e.uuid,id:e.record_id,"fee-payment":e.feePayment},on:{completed:e.paymentMade,closeFeePaymentForm:function(t){e.feePaymentForm=!1}}}):e._e(),e._v(" "),e.feePaymentShow?t("transition",{attrs:{name:"modal"}},[t("div",{staticClass:"modal-mask"},[t("div",{staticClass:"modal-wrapper"},[t("div",{staticClass:"modal-container modal-lg"},[t("div",{staticClass:"modal-header"},[e._t("header",(function(){return[e._v("\n                            "+e._s(e.trans("finance.fee_payment"))+"\n                            "),t("span",{staticClass:"float-right pointer",on:{click:function(t){e.feePaymentShow=!1}}},[e._v("x")])]}))],2),e._v(" "),t("div",{staticClass:"modal-body"},[e._t("body",(function(){return[t("div",{staticStyle:{"max-height":"600px"}},[t("fee-detail",{attrs:{uuid:e.uuid,rid:e.record_id,id:e.student_fee_record_id},on:{completed:e.getRecord}}),e._v(" "),t("div",{staticClass:"clearfix"})],1)]}))],2)])])])]):e._e()],1)}),[function(){var e=this._self._c;return e("button",{staticClass:"btn btn-sm btn-success dropdown-toggle dropdown-toggle-split",attrs:{type:"button","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"}},[e("span",{staticClass:"sr-only"},[this._v("Toggle Dropdown")])])},function(){var e=this._self._c;return e("button",{staticClass:"btn btn-sm btn-warning dropdown-toggle dropdown-toggle-split",attrs:{type:"button","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"}},[e("span",{staticClass:"sr-only"},[this._v("Toggle Dropdown")])])}],!1,null,null,null).exports},22846:(e,t,n)=>{n.d(t,{Z:()=>r});const a={props:["studentRecord"],data:function(){return{student_record:{}}},mounted:function(){},methods:{getStudentName:function(e){return helper.getStudentName(e)},getAdmissionNumber:function(e){return helper.getAdmissionNumber(e)}},filters:{moment:function(e){return helper.formatDate(e)},momentDateTime:function(e){return helper.formatDateTime(e)}},computed:{getImage:function(){return this.student_record.student.student_photo?"/"+this.student_record.student.student_photo:"female"==this.student_record.student.gender?"/images/female.png":"/images/male.png"}},watch:{studentRecord:function(e){this.student_record=e}}};const r=(0,n(51900).Z)(a,(function(){var e=this,t=e._self._c;return e.student_record.student?t("div",{staticClass:"row"},[t("div",{staticClass:"col-12 col-sm-3"},[t("div",{staticClass:"form-group text-center"},[t("img",{staticClass:"img-fluid",staticStyle:{"max-width":"200px"},attrs:{src:e.getImage}})])]),e._v(" "),t("div",{staticClass:"col-12 col-sm-4"},[t("div",{staticClass:"table-responsive"},[t("table",{staticClass:"table table-borderless custom-show-table"},[t("tbody",[t("tr",[t("td",{staticClass:"font-weight-bold"},[e._v(e._s(e.trans("student.name")))]),e._v(" "),t("td",[e._v(e._s(e.getStudentName(e.student_record.student)))])]),e._v(" "),t("tr",[t("td",{staticClass:"font-weight-bold"},[e._v(e._s(e.trans("student.admission_number")))]),e._v(" "),t("td",[e._v(e._s(e.getAdmissionNumber(e.student_record.admission)))])]),e._v(" "),t("tr",[t("td",{staticClass:"font-weight-bold"},[e._v(e._s(e.trans("student.date_of_admission")))]),e._v(" "),t("td",[e._v(e._s(e._f("moment")(e.student_record.admission.date_of_admission)))])]),e._v(" "),t("tr",[t("td",{staticClass:"font-weight-bold"},[e._v(e._s(e.trans("academic.course")))]),e._v(" "),t("td",[e._v(e._s(e.student_record.batch.course.name+" ("+e.student_record.batch.course.course_group.name+")"))])]),e._v(" "),t("tr",[t("td",{staticClass:"font-weight-bold"},[e._v(e._s(e.trans("academic.batch")))]),e._v(" "),t("td",[e._v(e._s(e.student_record.batch.name))])]),e._v(" "),t("tr",[t("td",{staticClass:"font-weight-bold"},[e._v(e._s(e.trans("student.date_of_birth")))]),e._v(" "),t("td",[e._v(e._s(e._f("moment")(e.student_record.student.date_of_birth)))])])])])])]),e._v(" "),t("div",{staticClass:"col-12 col-sm-4"},[t("div",{staticClass:"table-responsive"},[t("table",{staticClass:"table table-borderless custom-show-table"},[t("tbody",[t("tr",[t("td",{staticClass:"font-weight-bold"},[e._v(e._s(e.trans("student.father_name")))]),e._v(" "),t("td",[e._v(e._s(e.student_record.student.parent?e.student_record.student.parent.father_name:""))])]),e._v(" "),t("tr",[t("td",{staticClass:"font-weight-bold"},[e._v(e._s(e.trans("student.mother_name")))]),e._v(" "),t("td",[e._v(e._s(e.student_record.student.parent?e.student_record.student.parent.mother_name:""))])]),e._v(" "),t("tr",[t("td",{staticClass:"font-weight-bold"},[e._v(e._s(e.trans("student.contact_number")))]),e._v(" "),t("td",[e._v(e._s(e.student_record.student.contact_number))])]),e._v(" "),t("tr",[t("td",{staticClass:"font-weight-bold"},[e._v(e._s(e.trans("student.present_address")))]),e._v(" "),t("td",[e._v("\n\t                            "+e._s(e.student_record.student.present_address_line_1)+"\n\t                            "),e.student_record.student.present_address_line_2?t("span",[e._v(", "+e._s(e.student_record.student.present_address_line_2))]):e._e(),e._v(" "),e.student_record.student.present_city?t("span",[t("br"),e._v(" "+e._s(e.student_record.student.present_city))]):e._e(),e._v(" "),e.student_record.student.present_state?t("span",[e._v(", "+e._s(e.student_record.student.present_state))]):e._e(),e._v(" "),e.student_record.student.present_zipcode?t("span",[e._v(", "+e._s(e.student_record.student.present_zipcode))]):e._e(),e._v(" "),e.student_record.student.present_country?t("span",[t("br"),e._v(" "+e._s(e.student_record.student.present_country))]):e._e()])])])])])])]):e._e()}),[],!1,null,null,null).exports}}]);