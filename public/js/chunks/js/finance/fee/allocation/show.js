"use strict";(self.webpackChunkInstiKit=self.webpackChunkInstiKit||[]).push([[7015],{50680:(e,t,n)=>{n.d(t,{Z:()=>i});var r=n(94015),a=n.n(r),s=n(23645),o=n.n(s)()(a());o.push([e.id,".loading-overlay.is-full-page{z-index:1060}","",{version:3,sources:["webpack://./resources/js/views/finance/fee/allocation/show.vue"],names:[],mappings:"AA6ZA,8BACA,YACA",sourcesContent:['<template>\r\n    <div>\r\n        <div class="page-titles">\r\n            <div class="row">\r\n                <div class="col-12 col-sm-6">\r\n                    <h3 class="text-themecolor">{{trans(\'finance.fee_allocation\')}} \r\n                        <template v-if="fee_allocation.course">{{fee_allocation.course.name}}</template>\r\n                        <template v-if="!fee_allocation.course && fee_allocation.batch">{{fee_allocation.batch.course.name+\' \'+fee_allocation.batch.name}}</template>\r\n                        <i class="fas fa-lock fa-lg" v-if="fee_allocation.paid_count"></i>\r\n                    </h3>\r\n                </div>\r\n                <div class="col-12 col-sm-6">\r\n                    <div class="action-buttons pull-right">\r\n                        <button class="btn btn-info btn-sm" @click="$router.push(\'/finance/fee/allocation\')"><i class="fas fa-list"></i> <span class="d-none d-sm-inline">{{trans(\'finance.fee_allocation\')}}</span></button>\r\n                        <div class="btn-group">\r\n                            <button type="button" class="btn btn-info btn-sm dropdown-toggle no-caret " role="menu" id="moreOption" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" v-tooltip="trans(\'general.more_option\')">\r\n                                <i class="fas fa-ellipsis-h"></i> <span class="d-none d-sm-inline"></span>\r\n                            </button>\r\n                            <div :class="[\'dropdown-menu\',getConfig(\'direction\') == \'ltr\' ? \'dropdown-menu-right\' : \'\']" aria-labelledby="moreOption">\r\n                                <button class="dropdown-item custom-dropdown" @click="print"><i class="fas fa-print"></i> {{trans(\'general.print\')}}</button>\r\n                                <button class="dropdown-item custom-dropdown" @click="pdf"><i class="fas fa-file-pdf"></i> {{trans(\'general.generate_pdf\')}}</button>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n        <div class="container-fluid">\r\n            <div class="card p-4">\r\n                <div class="card-body">\r\n                    <div class="row">\r\n                        <div class="col-12 col-sm-4">\r\n                            <div class="form-group">\r\n                                <label for="">{{trans(\'transport.circle\')}}</label>\r\n                                <v-select label="name" v-model="selected_transport_circle" name="transport_circle_id" id="transport_circle_id" :options="transport_circles" :placeholder="trans(\'general.select_one\')" @select="onTransportCircleSelect" @close="" @remove="onTransportCircleRemove">\r\n                                    <div class="multiselect__option" slot="afterList" v-if="!transport_circles.length">\r\n                                        {{trans(\'general.no_option_found\')}}\r\n                                    </div>\r\n                                </v-select>\r\n                            </div>\r\n                        </div>\r\n                        <div class="col-12 col-sm-4">\r\n                            <div class="form-group">\r\n                                <label for="">{{trans(\'finance.fee_concession\')}}</label>\r\n                                <v-select label="name" v-model="selected_fee_concession" name="fee_concession_id" id="fee_concession_id" :options="fee_concessions" :placeholder="trans(\'general.select_one\')" @select="onFeeConcessionSelect" @close="" @remove="onFeeConcessionRemove">\r\n                                    <div class="multiselect__option" slot="afterList" v-if="!fee_concessions.length">\r\n                                        {{trans(\'general.no_option_found\')}}\r\n                                    </div>\r\n                                </v-select>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <div class="card" v-for="group in fee.groups">\r\n                <div class="card-body">\r\n                    <h4 class="card-title px-4">{{group.name}}</h4>\r\n                    <div class="table-responsive">\r\n                        <table class="table table-sm">\r\n                            <thead>\r\n                                <tr>\r\n                                    <th v-for="head in group.heads">{{head}}</th>\r\n                                    <th></th>\r\n                                </tr>\r\n                            </thead>\r\n                            <tbody>\r\n                                <tr v-for="installment in group.installments">\r\n                                    <td v-for="detail in installment.data">\r\n                                        <template v-if="detail.is_concession && detail.text != detail.actual"><span style="text-decoration: line-through;">{{detail.actual}}</span> {{detail.text}}</template>\r\n                                        <template v-else>{{detail.text}}</template>\r\n\r\n                                        <template v-if="detail.is_optional"><small>({{trans(\'finance.optional\')}})</small></template>\r\n                                    </td>\r\n                                    <td>\r\n                                        <button class="btn btn-info btn-sm" v-if="hasPermission(\'edit-fee-allocation\')" v-tooltip="trans(\'finance.edit_fee_installment\')" @click.prevent="showEditAction(installment)"><i class="fas fa-edit"></i></button>\r\n                                    </td>\r\n                                </tr>\r\n                                <tr>\r\n                                    <td v-for="foot in group.foots">{{foot}}</td>\r\n                                    <td></td>\r\n                                </tr>\r\n                            </tbody>\r\n                        </table>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <transition name="modal" v-if="showEditModal">\r\n            <div class="modal-mask">\r\n                <div class="modal-wrapper">\r\n                    <div class="modal-container modal-lg">\r\n                        <div class="modal-header">\r\n                            <slot name="header">\r\n                                {{trans(\'finance.edit_fee_installment\')}}\r\n                                <span class="float-right pointer" @click="showEditModal = false">x</span>\r\n                            </slot>\r\n                        </div>\r\n                        <div class="modal-body">\r\n                            <slot name="body">\r\n                                <fee-installment-form :iuuid="iuuid" @completed="getFeeAllocation" @close="showEditModal = false"></fee-installment-form>\r\n                                <div class="clearfix"></div>\r\n                            </slot>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </transition>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n    import feeInstallmentForm from \'./fee-installment-form\'\r\n\r\n    export default {\r\n        components : { feeInstallmentForm },\r\n        data() {\r\n            return {\r\n                uuid:this.$route.params.uuid,\r\n                fee_allocation: {\r\n                \tbatch: {\r\n\r\n                \t},\r\n                \tcourse: {\r\n\r\n                \t},\r\n                \tfee_installments: []\r\n                },\r\n                transport_circles: [],\r\n                transport_fee_details: [],\r\n                fee_concession_details: [],\r\n                fee_concessions: [],\r\n                transport_circle_id: \'\',\r\n                selected_transport_circle: null,\r\n                fee_concession_id: \'\',\r\n                selected_fee_concession: null,\r\n                fee: {\r\n                    groups: []\r\n                },\r\n                iuuid: \'\',\r\n                showEditModal: false\r\n            }\r\n        },\r\n        mounted(){\r\n            if(!helper.hasPermission(\'list-fee-allocation\')){\r\n                helper.notAccessibleMsg();\r\n                this.$router.push(\'/dashboard\');\r\n            }\r\n\r\n            this.getPreRequisite();\r\n\r\n            this.getFeeAllocation();\r\n        },\r\n        methods: {\r\n            getConfig(config){\r\n                return helper.getConfig(config);\r\n            },\r\n            hasPermission(permission){\r\n                return helper.hasPermission(permission);\r\n            },\r\n            getPreRequisite(){\r\n                let loader = this.$loading.show();\r\n                axios.get(\'/api/fee/allocation/show/pre-requisite\')\r\n                    .then(response => {\r\n                        this.transport_circles = response.transport_circles;\r\n                        this.fee_concessions = response.fee_concessions;\r\n                        this.transport_fee_details = response.transport_fee_details;\r\n                        this.fee_concession_details = response.fee_concession_details;\r\n                        loader.hide();\r\n                    })\r\n                    .catch(error => {\r\n                        loader.hide();\r\n                        helper.showErrorMsg(error);\r\n                    });\r\n            },\r\n        \tgetFeeAllocation(){\r\n                let loader = this.$loading.show();\r\n        \t\taxios.get(\'/api/fee/allocation/\'+this.uuid)\r\n        \t\t\t.then(response => {\r\n        \t\t\t\tthis.fee_allocation = response;\r\n                        this.calculate();\r\n                        loader.hide();\r\n        \t\t\t})\r\n        \t\t\t.catch(error => {\r\n                        loader.hide();\r\n        \t\t\t\thelper.showErrorMsg(error);\r\n        \t\t\t\tthis.$router.push(\'/finance/fee/allocation\');\r\n        \t\t\t})\r\n        \t},\r\n            showEditAction(installment){\r\n                this.iuuid = installment.uuid;\r\n                this.showEditModal = true;\r\n            },\r\n            calculate(){\r\n                this.fee = {\r\n                    groups: []\r\n                };\r\n                this.fee_allocation.fee_allocation_groups.forEach(fee_allocation_group => {\r\n                    let installments = [];\r\n                    let heads = [];\r\n                    let foots = [];\r\n                    heads.push(i18n.finance.fee_installment_title);\r\n                    heads.push(i18n.finance.fee_installment_due_date);\r\n                    heads.push(i18n.finance.late_fee);\r\n\r\n                    foots.push(i18n.finance.total);\r\n                    foots.push(\'\');\r\n                    foots.push(\'\');\r\n\r\n                    fee_allocation_group.fee_group.fee_heads.forEach(fee_head => {\r\n                        heads.push(fee_head.name);\r\n                    });\r\n\r\n                    let has_transport = (fee_allocation_group.fee_group.options && fee_allocation_group.fee_group.options.has_transport) ? true : false;\r\n\r\n                    if (has_transport)\r\n                        heads.push(i18n.transport.fee);\r\n\r\n                    heads.push(i18n.finance.installment_total);\r\n\r\n                    fee_allocation_group.fee_installments.forEach(fee_installment => {\r\n                        let installment_data = [];\r\n                        installment_data.push({\r\n                            text: fee_installment.title\r\n                        });\r\n                        installment_data.push({\r\n                            text: this.showDate(fee_installment.due_date)\r\n                        });\r\n\r\n                        let late_fee = (fee_installment.late_fee_applicable) ? (this.formatCurrency(fee_installment.late_fee)+\'/\'+this.getLateFeeFrequencyName(fee_installment.late_fee_frequency)) : \'-\';\r\n\r\n                        installment_data.push({\r\n                            text: late_fee\r\n                        });\r\n\r\n                        fee_allocation_group.fee_group.fee_heads.forEach(fee_head => {\r\n                            installment_data.push({\r\n                                text: this.formatCurrency(this.getFee(fee_installment, fee_head.id, 1)),\r\n                                actual: this.formatCurrency(this.getFee(fee_installment, fee_head.id, 0)),\r\n                                is_concession: this.fee_concession_id ? true : false,\r\n                                is_optional: this.isFeeHeadOptional(fee_installment, fee_head.id)\r\n                            });\r\n                        });\r\n\r\n                        if (has_transport)\r\n                            installment_data.push({\r\n                                text: this.getTransportFee(fee_allocation_group,fee_installment.id)\r\n                            });\r\n\r\n                        installment_data.push({\r\n                            text: this.formatCurrency(this.getInstallmentTotal(fee_allocation_group, fee_installment))\r\n                        });\r\n\r\n                        installments.push({\r\n                            uuid: fee_installment.uuid,\r\n                            data: installment_data\r\n                        });\r\n                    });\r\n\r\n                    fee_allocation_group.fee_group.fee_heads.forEach(fee_head => {\r\n                        foots.push(this.formatCurrency(this.getTotalFee(fee_allocation_group, fee_head.id)));\r\n                    });\r\n                    \r\n                    if (has_transport)\r\n                        foots.push(this.getTransportFeeTotal(fee_allocation_group));\r\n                    \r\n                    foots.push(this.formatCurrency(this.getInstallmentGrandTotal(fee_allocation_group)));\r\n\r\n                    let group = {\r\n                        name: fee_allocation_group.fee_group.name,\r\n                        heads: heads,\r\n                        installments: installments,\r\n                        foots: foots,\r\n                    }\r\n                    this.fee.groups.push(group);\r\n                });\r\n            },\r\n            formatCurrency(amount){\r\n                return helper.formatCurrency(amount);\r\n            },\r\n            getLateFeeFrequencyName(frequency){\r\n                return helper.getLateFeeFrequencyName(frequency);\r\n            },\r\n            onTransportCircleSelect(selectedOption){\r\n                this.transport_circle_id = selectedOption.id;\r\n                this.calculate();\r\n            },\r\n            onTransportCircleRemove(){\r\n                this.transport_circle_id = \'\';\r\n                this.calculate();\r\n            },\r\n            onFeeConcessionSelect(selectedOption){\r\n                this.fee_concession_id = selectedOption.id;\r\n                this.calculate();\r\n            },\r\n            onFeeConcessionRemove(){\r\n                this.fee_concession_id = \'\';\r\n                this.calculate();\r\n            },\r\n            isFeeHeadOptional(fee_installment, fee_head_id){\r\n                let installment = fee_installment.fee_installment_details.find(o => o.fee_head_id == fee_head_id);\r\n                return (installment && installment.is_optional) ? true : false;\r\n            },\r\n            getFee(fee_installment, fee_head_id, fee_con){\r\n                let installment = fee_installment.fee_installment_details.find(o => o.fee_head_id == fee_head_id);\r\n                let amount = (installment) ? installment.amount : 0;\r\n                let discount = 0;\r\n\r\n                if (this.fee_concession_id && fee_con) {\r\n                    let concession = this.fee_concession_details.find(o => o.fee_concession_id == this.fee_concession_id && o.fee_head_id == fee_head_id);\r\n                    discount = (concession) ? (concession.type == \'percent\' ? (amount * (concession.amount/100)) : concession.amount) : 0;\r\n                }\r\n\r\n                amount -= discount;\r\n\r\n                if (amount < 0)\r\n                    amount = 0;\r\n\r\n                return amount;\r\n            },\r\n            getTotalFee(fee_allocation_group, fee_head_id){\r\n                let total = 0;\r\n                fee_allocation_group.fee_installments.forEach(fee_installment => {\r\n                    total += this.getFee(fee_installment, fee_head_id, 1);\r\n                });\r\n                return total;\r\n            },\r\n            getInstallmentTotal(fee_allocation_group, fee_installment) {\r\n                let total = 0;\r\n                fee_allocation_group.fee_group.fee_heads.forEach(fee_head => {\r\n                    total += this.getFee(fee_installment, fee_head.id, 1);\r\n                });\r\n                total += this.getTransportFeeAmount(fee_allocation_group, fee_installment.id);\r\n                return total;\r\n            },\r\n            getInstallmentGrandTotal(fee_allocation_group){\r\n                let total = 0;\r\n                fee_allocation_group.fee_installments.forEach(fee_installment => {\r\n                    total += this.getInstallmentTotal(fee_allocation_group, fee_installment);\r\n                });\r\n                return total;\r\n            },\r\n            getTransportFeeTotal(fee_allocation_group){\r\n                let total = 0;\r\n                fee_allocation_group.fee_installments.forEach(fee_installment => {\r\n                    total += this.getTransportFeeAmount(fee_allocation_group, fee_installment.id);\r\n                });\r\n                return total ? this.formatCurrency(total) : \'-\';\r\n            },\r\n            getTransportFee(fee_allocation_group,fee_installment_id){\r\n                let fee = this.getTransportFeeAmount(fee_allocation_group, fee_installment_id);\r\n                return fee ? this.formatCurrency(fee) : \'-\';\r\n            },\r\n            getTransportFeeAmount(fee_allocation_group, fee_installment_id){\r\n                if (!fee_allocation_group.fee_group.options || (fee_allocation_group.fee_group.options && !fee_allocation_group.fee_group.options.has_transport))\r\n                    return 0;\r\n\r\n                let installment = fee_allocation_group.fee_installments.find(o => o.id == fee_installment_id);\r\n\r\n                if (!installment || (installment && !installment.transport_fee_id))\r\n                    return 0;\r\n\r\n                let transport_fee_detail = this.transport_fee_details.find(o => o.transport_fee_id == installment.transport_fee_id && o.transport_circle_id == this.transport_circle_id);\r\n\r\n                return (transport_fee_detail) ? transport_fee_detail.amount : 0;\r\n            },\r\n            showDate(date){\r\n                return helper.formatDate(date);\r\n            },\r\n            print(){\r\n                let loader = this.$loading.show();\r\n                axios.post(\'/api/fee/allocation/\'+this.uuid+\'/print\',{fee: this.fee})\r\n                    .then(response => {\r\n                        let print = window.open("/print");\r\n                        loader.hide();\r\n                        print.document.write(response);\r\n                    })\r\n                    .catch(error => {\r\n                        loader.hide();\r\n                        helper.showErrorMsg(error);\r\n                    });\r\n            },\r\n            pdf(){\r\n                let loader = this.$loading.show();\r\n                axios.post(\'/api/fee/allocation/\'+this.uuid+\'/pdf\',{fee: this.fee})\r\n                    .then(response => {\r\n                        loader.hide();\r\n                        window.open(\'/download/report/\'+response+\'?token=\'+this.authToken);\r\n                    })\r\n                    .catch(error => {\r\n                        loader.hide();\r\n                        helper.showErrorMsg(error);\r\n                    });\r\n            }\r\n        },\r\n        filters: {\r\n          moment(date) {\r\n            return helper.formatDate(date);\r\n          },\r\n          momentDateTime(date) {\r\n            return helper.formatDateTime(date);\r\n          }\r\n        },\r\n        computed: {\r\n            authToken(){\r\n                return helper.getAuthToken();\r\n            }\r\n        }\r\n    }\r\n<\/script>\r\n\r\n<style>\r\n.loading-overlay.is-full-page{\r\n    z-index: 1060;\r\n}\r\n</style>'],sourceRoot:""}]);const i=o},44248:(e,t,n)=>{n.r(t),n.d(t,{default:()=>f});const r={components:{},props:["iuuid"],data:function(){return{feeInstallmentForm:new Form({title:"",due_date:"",late_fee_applicable:"",late_fee_frequency:"",late_fee:"",fee_heads:[],selected_transport_fee:null,transport_fee_id:""}),fee_group:{},paid_installment:0,transport_fees:[],late_fee_frequencies:[]}},mounted:function(){this.getPreRequisite(),this.getInstallment()},methods:{getPreRequisite:function(){var e=this,t=this.$loading.show();axios.get("/api/fee/installment/pre-requisite").then((function(n){e.late_fee_frequencies=n.late_fee_frequencies,e.transport_fees=n.transport_fees,t.hide()})).catch((function(e){t.hide(),helper.showErrorMsg(e)}))},getFeeName:function(e,t){return e+"_"+t+"_fee"},getTransportFeeName:function(e){return e+"_transport_fee"},getInstallment:function(){var e=this,t=this.$loading.show();axios.get("/api/fee/installment/"+this.iuuid).then((function(n){e.feeInstallmentForm.fee_heads=[],e.feeInstallmentForm.title=n.title,e.feeInstallmentForm.due_date=n.due_date,e.feeInstallmentForm.late_fee_applicable=n.late_fee_applicable,e.feeInstallmentForm.late_fee_frequency=n.late_fee_frequency,e.feeInstallmentForm.late_fee=n.late_fee,e.feeInstallmentForm.transport_fee_id=n.transport_fee_id,e.feeInstallmentForm.selected_transport_fee=n.transport_fee_id?{id:n.transport_fee_id,name:n.transport_fee.name}:null,e.paid_installment=n.paid_installment,e.fee_group=n.fee_allocation_group.fee_group,n.fee_installment_details.forEach((function(t){e.feeInstallmentForm.fee_heads.push({id:t.fee_head_id,amount:t.amount,is_optional:t.is_optional,name:t.fee_head.name})})),t.hide()})).catch((function(e){t.hide(),helper.showErrorMsg(e)})),this.$emit("loaded")},submit:function(){var e=this,t=this.$loading.show();this.feeInstallmentForm.patch("/api/fee/installment/"+this.iuuid).then((function(n){toastr.success(n.message),e.$emit("completed"),t.hide()})).catch((function(e){t.hide(),helper.showErrorMsg(e)}))},onTransportFeeSelect:function(e,t){this.feeInstallmentForm.transport_fee_id=e.id}}};var a=n(51900);const s={components:{feeInstallmentForm:(0,a.Z)(r,(function(){var e=this,t=e._self._c;return t("div",[t("form",{on:{submit:function(t){return t.preventDefault(),e.submit.apply(null,arguments)},keydown:function(t){return e.feeInstallmentForm.errors.clear(t.target.name)}}},[t("div",{staticClass:"row"},[t("div",{staticClass:"col-12"},[t("div",{staticClass:"row"},[t("div",{staticClass:"col-12 col-sm-6"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:""}},[e._v(e._s(e.trans("finance.fee_installment_title")))]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.feeInstallmentForm.title,expression:"feeInstallmentForm.title"}],staticClass:"form-control",attrs:{type:"text",name:"title",placeholder:e.trans("finance.fee_installment_title"),disabled:e.paid_installment>0},domProps:{value:e.feeInstallmentForm.title},on:{input:function(t){t.target.composing||e.$set(e.feeInstallmentForm,"title",t.target.value)}}}),e._v(" "),t("show-error",{attrs:{"form-name":e.feeInstallmentForm,"prop-name":"title"}})],1)]),e._v(" "),t("div",{staticClass:"col-12 col-sm-6"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:""}},[e._v(e._s(e.trans("finance.fee_installment_due_date")))]),e._v(" "),t("datepicker",{attrs:{bootstrapStyling:!0,placeholder:e.trans("finance.fee_installment_due_date"),name:"due_date"},on:{selected:function(t){return e.feeInstallmentForm.errors.clear("due_date")}},model:{value:e.feeInstallmentForm.due_date,callback:function(t){e.$set(e.feeInstallmentForm,"due_date",t)},expression:"feeInstallmentForm.due_date"}}),e._v(" "),t("show-error",{attrs:{"form-name":e.feeInstallmentForm,"prop-name":"due_date"}})],1)]),e._v(" "),t("div",{staticClass:"col-12 col-sm-4"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:""}},[e._v(e._s(e.trans("finance.late_fee_applicable")))]),e._v(" "),t("br"),e._v(" "),t("switches",{staticClass:"m-l-20",attrs:{theme:"bootstrap",color:"success"},model:{value:e.feeInstallmentForm.late_fee_applicable,callback:function(t){e.$set(e.feeInstallmentForm,"late_fee_applicable",t)},expression:"feeInstallmentForm.late_fee_applicable"}})],1)]),e._v(" "),e.feeInstallmentForm.late_fee_applicable?t("div",{staticClass:"col-12 col-sm-4"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:""}},[e._v(e._s(e.trans("finance.late_fee_frequency")))]),e._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:e.feeInstallmentForm.late_fee_frequency,expression:"feeInstallmentForm.late_fee_frequency"}],staticClass:"custom-select col-12",attrs:{name:"late_fee_frequency"},on:{change:function(t){var n=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){return"_value"in e?e._value:e.value}));e.$set(e.feeInstallmentForm,"late_fee_frequency",t.target.multiple?n:n[0])}}},[t("option",{attrs:{value:"0"}},[e._v(e._s(e.trans("general.select_one")))]),e._v(" "),e._l(e.late_fee_frequencies,(function(n){return t("option",{domProps:{value:n.value}},[e._v("\n                                    "+e._s(n.text)+"\n                                  ")])}))],2),e._v(" "),t("show-error",{attrs:{"form-name":e.feeInstallmentForm,"prop-name":"late_fee_frequency"}})],1)]):e._e(),e._v(" "),e.feeInstallmentForm.late_fee_applicable?t("div",{staticClass:"col-12 col-sm-4"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:""}},[e._v(e._s(e.trans("finance.late_fee")))]),e._v(" "),t("input",{directives:[{name:"model",rawName:"v-model",value:e.feeInstallmentForm.late_fee,expression:"feeInstallmentForm.late_fee"}],staticClass:"form-control",attrs:{type:"text",name:"late_fee",placeholder:e.trans("finance.late_fee")},domProps:{value:e.feeInstallmentForm.late_fee},on:{input:function(t){t.target.composing||e.$set(e.feeInstallmentForm,"late_fee",t.target.value)}}}),e._v(" "),t("show-error",{attrs:{"form-name":e.feeInstallmentForm,"prop-name":"late_fee"}})],1)]):e._e()]),e._v(" "),t("div",{staticClass:"row"},[e._l(e.feeInstallmentForm.fee_heads,(function(n,r){return t("div",{staticClass:"col-12 col-sm-6"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:""}},[e._v(e._s(n.name))]),e._v(" "),t("div",{staticClass:"input-group mb-3"},[t("input",{directives:[{name:"model",rawName:"v-model",value:n.amount,expression:"fee_head.amount"}],staticClass:"form-control",attrs:{type:"text",name:e.getFeeName(r,n.id),placeholder:e.trans("finance.fee_installment_amount"),disabled:e.paid_installment>0},domProps:{value:n.amount},on:{input:function(t){t.target.composing||e.$set(n,"amount",t.target.value)}}}),e._v(" "),t("div",{staticClass:"input-group-append"},[t("div",{staticClass:"input-group-text"},[t("input",{directives:[{name:"model",rawName:"v-model",value:n.is_optional,expression:"fee_head.is_optional"},{name:"tooltip",rawName:"v-tooltip",value:e.trans("finance.fee_is_optional"),expression:"trans('finance.fee_is_optional')"}],attrs:{type:"checkbox",disabled:e.paid_installment>0},domProps:{checked:Array.isArray(n.is_optional)?e._i(n.is_optional,null)>-1:n.is_optional},on:{change:function(t){var r=n.is_optional,a=t.target,s=!!a.checked;if(Array.isArray(r)){var o=e._i(r,null);a.checked?o<0&&e.$set(n,"is_optional",r.concat([null])):o>-1&&e.$set(n,"is_optional",r.slice(0,o).concat(r.slice(o+1)))}else e.$set(n,"is_optional",s)}}})])])]),e._v(" "),t("show-error",{attrs:{"form-name":e.feeInstallmentForm,"prop-name":e.getFeeName(r,n.id)}})],1)])})),e._v(" "),e.fee_group.options&&e.fee_group.options.has_transport?t("div",{staticClass:"col-12 col-sm-6"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:""}},[e._v(e._s(e.trans("transport.transport")))]),e._v(" "),t("v-select",{attrs:{label:"name",name:"transport_fee",id:"transport_fee",options:e.transport_fees,placeholder:e.trans("general.select_one"),disabled:e.paid_installment>0},on:{select:e.onTransportFeeSelect,close:function(e){},remove:function(e){}},model:{value:e.feeInstallmentForm.selected_transport_fee,callback:function(t){e.$set(e.feeInstallmentForm,"selected_transport_fee",t)},expression:"feeInstallmentForm.selected_transport_fee"}},[e.transport_fees.length?e._e():t("div",{staticClass:"multiselect__option",attrs:{slot:"afterList"},slot:"afterList"},[e._v("\n                                        "+e._s(e.trans("general.no_option_found"))+"\n                                    ")])]),e._v(" "),t("show-error",{attrs:{"form-name":e.feeInstallmentForm,"prop-name":"transport_fee"}})],1)]):e._e()],2)])]),e._v(" "),t("div",{staticClass:"card-footer text-right"},[t("button",{staticClass:"btn btn-info waves-effect waves-light",attrs:{type:"submit"}},[e._v(e._s(e.trans("general.save")))])])])])}),[],!1,null,null,null).exports},data:function(){return{uuid:this.$route.params.uuid,fee_allocation:{batch:{},course:{},fee_installments:[]},transport_circles:[],transport_fee_details:[],fee_concession_details:[],fee_concessions:[],transport_circle_id:"",selected_transport_circle:null,fee_concession_id:"",selected_fee_concession:null,fee:{groups:[]},iuuid:"",showEditModal:!1}},mounted:function(){helper.hasPermission("list-fee-allocation")||(helper.notAccessibleMsg(),this.$router.push("/dashboard")),this.getPreRequisite(),this.getFeeAllocation()},methods:{getConfig:function(e){return helper.getConfig(e)},hasPermission:function(e){return helper.hasPermission(e)},getPreRequisite:function(){var e=this,t=this.$loading.show();axios.get("/api/fee/allocation/show/pre-requisite").then((function(n){e.transport_circles=n.transport_circles,e.fee_concessions=n.fee_concessions,e.transport_fee_details=n.transport_fee_details,e.fee_concession_details=n.fee_concession_details,t.hide()})).catch((function(e){t.hide(),helper.showErrorMsg(e)}))},getFeeAllocation:function(){var e=this,t=this.$loading.show();axios.get("/api/fee/allocation/"+this.uuid).then((function(n){e.fee_allocation=n,e.calculate(),t.hide()})).catch((function(n){t.hide(),helper.showErrorMsg(n),e.$router.push("/finance/fee/allocation")}))},showEditAction:function(e){this.iuuid=e.uuid,this.showEditModal=!0},calculate:function(){var e=this;this.fee={groups:[]},this.fee_allocation.fee_allocation_groups.forEach((function(t){var n=[],r=[],a=[];r.push(i18n.finance.fee_installment_title),r.push(i18n.finance.fee_installment_due_date),r.push(i18n.finance.late_fee),a.push(i18n.finance.total),a.push(""),a.push(""),t.fee_group.fee_heads.forEach((function(e){r.push(e.name)}));var s=!(!t.fee_group.options||!t.fee_group.options.has_transport);s&&r.push(i18n.transport.fee),r.push(i18n.finance.installment_total),t.fee_installments.forEach((function(r){var a=[];a.push({text:r.title}),a.push({text:e.showDate(r.due_date)});var o=r.late_fee_applicable?e.formatCurrency(r.late_fee)+"/"+e.getLateFeeFrequencyName(r.late_fee_frequency):"-";a.push({text:o}),t.fee_group.fee_heads.forEach((function(t){a.push({text:e.formatCurrency(e.getFee(r,t.id,1)),actual:e.formatCurrency(e.getFee(r,t.id,0)),is_concession:!!e.fee_concession_id,is_optional:e.isFeeHeadOptional(r,t.id)})})),s&&a.push({text:e.getTransportFee(t,r.id)}),a.push({text:e.formatCurrency(e.getInstallmentTotal(t,r))}),n.push({uuid:r.uuid,data:a})})),t.fee_group.fee_heads.forEach((function(n){a.push(e.formatCurrency(e.getTotalFee(t,n.id)))})),s&&a.push(e.getTransportFeeTotal(t)),a.push(e.formatCurrency(e.getInstallmentGrandTotal(t)));var o={name:t.fee_group.name,heads:r,installments:n,foots:a};e.fee.groups.push(o)}))},formatCurrency:function(e){return helper.formatCurrency(e)},getLateFeeFrequencyName:function(e){return helper.getLateFeeFrequencyName(e)},onTransportCircleSelect:function(e){this.transport_circle_id=e.id,this.calculate()},onTransportCircleRemove:function(){this.transport_circle_id="",this.calculate()},onFeeConcessionSelect:function(e){this.fee_concession_id=e.id,this.calculate()},onFeeConcessionRemove:function(){this.fee_concession_id="",this.calculate()},isFeeHeadOptional:function(e,t){var n=e.fee_installment_details.find((function(e){return e.fee_head_id==t}));return!(!n||!n.is_optional)},getFee:function(e,t,n){var r=this,a=e.fee_installment_details.find((function(e){return e.fee_head_id==t})),s=a?a.amount:0,o=0;if(this.fee_concession_id&&n){var i=this.fee_concession_details.find((function(e){return e.fee_concession_id==r.fee_concession_id&&e.fee_head_id==t}));o=i?"percent"==i.type?s*(i.amount/100):i.amount:0}return(s-=o)<0&&(s=0),s},getTotalFee:function(e,t){var n=this,r=0;return e.fee_installments.forEach((function(e){r+=n.getFee(e,t,1)})),r},getInstallmentTotal:function(e,t){var n=this,r=0;return e.fee_group.fee_heads.forEach((function(e){r+=n.getFee(t,e.id,1)})),r+=this.getTransportFeeAmount(e,t.id)},getInstallmentGrandTotal:function(e){var t=this,n=0;return e.fee_installments.forEach((function(r){n+=t.getInstallmentTotal(e,r)})),n},getTransportFeeTotal:function(e){var t=this,n=0;return e.fee_installments.forEach((function(r){n+=t.getTransportFeeAmount(e,r.id)})),n?this.formatCurrency(n):"-"},getTransportFee:function(e,t){var n=this.getTransportFeeAmount(e,t);return n?this.formatCurrency(n):"-"},getTransportFeeAmount:function(e,t){var n=this;if(!e.fee_group.options||e.fee_group.options&&!e.fee_group.options.has_transport)return 0;var r=e.fee_installments.find((function(e){return e.id==t}));if(!r||r&&!r.transport_fee_id)return 0;var a=this.transport_fee_details.find((function(e){return e.transport_fee_id==r.transport_fee_id&&e.transport_circle_id==n.transport_circle_id}));return a?a.amount:0},showDate:function(e){return helper.formatDate(e)},print:function(){var e=this.$loading.show();axios.post("/api/fee/allocation/"+this.uuid+"/print",{fee:this.fee}).then((function(t){var n=window.open("/print");e.hide(),n.document.write(t)})).catch((function(t){e.hide(),helper.showErrorMsg(t)}))},pdf:function(){var e=this,t=this.$loading.show();axios.post("/api/fee/allocation/"+this.uuid+"/pdf",{fee:this.fee}).then((function(n){t.hide(),window.open("/download/report/"+n+"?token="+e.authToken)})).catch((function(e){t.hide(),helper.showErrorMsg(e)}))}},filters:{moment:function(e){return helper.formatDate(e)},momentDateTime:function(e){return helper.formatDateTime(e)}},computed:{authToken:function(){return helper.getAuthToken()}}};var o=n(93379),i=n.n(o),l=n(50680),c={insert:"head",singleton:!1};i()(l.Z,c);l.Z.locals;const f=(0,a.Z)(s,(function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"page-titles"},[t("div",{staticClass:"row"},[t("div",{staticClass:"col-12 col-sm-6"},[t("h3",{staticClass:"text-themecolor"},[e._v(e._s(e.trans("finance.fee_allocation"))+" \n                    "),e.fee_allocation.course?[e._v(e._s(e.fee_allocation.course.name))]:e._e(),e._v(" "),!e.fee_allocation.course&&e.fee_allocation.batch?[e._v(e._s(e.fee_allocation.batch.course.name+" "+e.fee_allocation.batch.name))]:e._e(),e._v(" "),e.fee_allocation.paid_count?t("i",{staticClass:"fas fa-lock fa-lg"}):e._e()],2)]),e._v(" "),t("div",{staticClass:"col-12 col-sm-6"},[t("div",{staticClass:"action-buttons pull-right"},[t("button",{staticClass:"btn btn-info btn-sm",on:{click:function(t){return e.$router.push("/finance/fee/allocation")}}},[t("i",{staticClass:"fas fa-list"}),e._v(" "),t("span",{staticClass:"d-none d-sm-inline"},[e._v(e._s(e.trans("finance.fee_allocation")))])]),e._v(" "),t("div",{staticClass:"btn-group"},[t("button",{directives:[{name:"tooltip",rawName:"v-tooltip",value:e.trans("general.more_option"),expression:"trans('general.more_option')"}],staticClass:"btn btn-info btn-sm dropdown-toggle no-caret",attrs:{type:"button",role:"menu",id:"moreOption","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"}},[t("i",{staticClass:"fas fa-ellipsis-h"}),e._v(" "),t("span",{staticClass:"d-none d-sm-inline"})]),e._v(" "),t("div",{class:["dropdown-menu","ltr"==e.getConfig("direction")?"dropdown-menu-right":""],attrs:{"aria-labelledby":"moreOption"}},[t("button",{staticClass:"dropdown-item custom-dropdown",on:{click:e.print}},[t("i",{staticClass:"fas fa-print"}),e._v(" "+e._s(e.trans("general.print")))]),e._v(" "),t("button",{staticClass:"dropdown-item custom-dropdown",on:{click:e.pdf}},[t("i",{staticClass:"fas fa-file-pdf"}),e._v(" "+e._s(e.trans("general.generate_pdf")))])])])])])])]),e._v(" "),t("div",{staticClass:"container-fluid"},[t("div",{staticClass:"card p-4"},[t("div",{staticClass:"card-body"},[t("div",{staticClass:"row"},[t("div",{staticClass:"col-12 col-sm-4"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:""}},[e._v(e._s(e.trans("transport.circle")))]),e._v(" "),t("v-select",{attrs:{label:"name",name:"transport_circle_id",id:"transport_circle_id",options:e.transport_circles,placeholder:e.trans("general.select_one")},on:{select:e.onTransportCircleSelect,close:function(e){},remove:e.onTransportCircleRemove},model:{value:e.selected_transport_circle,callback:function(t){e.selected_transport_circle=t},expression:"selected_transport_circle"}},[e.transport_circles.length?e._e():t("div",{staticClass:"multiselect__option",attrs:{slot:"afterList"},slot:"afterList"},[e._v("\n                                    "+e._s(e.trans("general.no_option_found"))+"\n                                ")])])],1)]),e._v(" "),t("div",{staticClass:"col-12 col-sm-4"},[t("div",{staticClass:"form-group"},[t("label",{attrs:{for:""}},[e._v(e._s(e.trans("finance.fee_concession")))]),e._v(" "),t("v-select",{attrs:{label:"name",name:"fee_concession_id",id:"fee_concession_id",options:e.fee_concessions,placeholder:e.trans("general.select_one")},on:{select:e.onFeeConcessionSelect,close:function(e){},remove:e.onFeeConcessionRemove},model:{value:e.selected_fee_concession,callback:function(t){e.selected_fee_concession=t},expression:"selected_fee_concession"}},[e.fee_concessions.length?e._e():t("div",{staticClass:"multiselect__option",attrs:{slot:"afterList"},slot:"afterList"},[e._v("\n                                    "+e._s(e.trans("general.no_option_found"))+"\n                                ")])])],1)])])])]),e._v(" "),e._l(e.fee.groups,(function(n){return t("div",{staticClass:"card"},[t("div",{staticClass:"card-body"},[t("h4",{staticClass:"card-title px-4"},[e._v(e._s(n.name))]),e._v(" "),t("div",{staticClass:"table-responsive"},[t("table",{staticClass:"table table-sm"},[t("thead",[t("tr",[e._l(n.heads,(function(n){return t("th",[e._v(e._s(n))])})),e._v(" "),t("th")],2)]),e._v(" "),t("tbody",[e._l(n.installments,(function(n){return t("tr",[e._l(n.data,(function(n){return t("td",[n.is_concession&&n.text!=n.actual?[t("span",{staticStyle:{"text-decoration":"line-through"}},[e._v(e._s(n.actual))]),e._v(" "+e._s(n.text))]:[e._v(e._s(n.text))],e._v(" "),n.is_optional?[t("small",[e._v("("+e._s(e.trans("finance.optional"))+")")])]:e._e()],2)})),e._v(" "),t("td",[e.hasPermission("edit-fee-allocation")?t("button",{directives:[{name:"tooltip",rawName:"v-tooltip",value:e.trans("finance.edit_fee_installment"),expression:"trans('finance.edit_fee_installment')"}],staticClass:"btn btn-info btn-sm",on:{click:function(t){return t.preventDefault(),e.showEditAction(n)}}},[t("i",{staticClass:"fas fa-edit"})]):e._e()])],2)})),e._v(" "),t("tr",[e._l(n.foots,(function(n){return t("td",[e._v(e._s(n))])})),e._v(" "),t("td")],2)],2)])])])])}))],2),e._v(" "),e.showEditModal?t("transition",{attrs:{name:"modal"}},[t("div",{staticClass:"modal-mask"},[t("div",{staticClass:"modal-wrapper"},[t("div",{staticClass:"modal-container modal-lg"},[t("div",{staticClass:"modal-header"},[e._t("header",(function(){return[e._v("\n                            "+e._s(e.trans("finance.edit_fee_installment"))+"\n                            "),t("span",{staticClass:"float-right pointer",on:{click:function(t){e.showEditModal=!1}}},[e._v("x")])]}))],2),e._v(" "),t("div",{staticClass:"modal-body"},[e._t("body",(function(){return[t("fee-installment-form",{attrs:{iuuid:e.iuuid},on:{completed:e.getFeeAllocation,close:function(t){e.showEditModal=!1}}}),e._v(" "),t("div",{staticClass:"clearfix"})]}))],2)])])])]):e._e()],1)}),[],!1,null,null,null).exports}}]);